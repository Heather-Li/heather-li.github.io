<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>game-demo-display</title>
  <link rel="icon" href="favicon.ico" />
  <link rel="stylesheet" href="./css/common.css">
  <link href="./css/bootstrap.min.css" rel="stylesheet">
</head>

<style>
  .mt-20px {
    margin-top: 20px;
  }

  .container-wrap {
    min-width: 430px;
    display: flex;
    padding: 20px;
    height: 100%;
  }

  .container-wrap.landscape {
    min-width: 932px;
  }

  @media screen and (max-width: 1200px) {
    .container-wrap.landscape {
      flex-direction: column;
    }
  }

  @media screen and (max-width: 430px) {
    .container-wrap {
      flex-direction: column;
    }

    .container-wrap.landscape {
      flex-direction: row;
    }
  }

  @media screen and (max-width: 900px) {
    .container-wrap {
      flex-direction: column;
    }
  }

  /* 自定义手机框架样式 */
  .phone-mockup {
    width: 375px;
    /* 标准移动端宽度 */
    height: 667px;
    border: 16px solid #222;
    border-radius: 36px;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
    background: #f8f9fa;
    transition: all 0.3s ease;
  }

  .phone-notch {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 40%;
    height: 20px;
    background: #222;
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
    z-index: 10;
    transition: all 0.3s ease;
  }

  /* 横屏时的notch样式 */
  .container-wrap.landscape .phone-notch {
    top: 50%;
    left: 0;
    transform: translateY(-50%);
    width: 20px;
    height: 40%;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    border-top-right-radius: 12px;
    border-bottom-right-radius: 12px;
  }

  .demo-frame {
    width: 100%;
    height: 100%;
    border: none;
    background: #222222;
    display: block;
    /* 消除iframe下方可能的空白缝隙 */
  }

  /* 标题样式 */
  .main-title {
    color: #333;
    font-weight: 600;
  }

  .loading {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100%;
    font-size: 18px;
    color: #666;
  }
</style>

<body class="bg-light">
  <div class="container-wrap" id="container">
    <!-- 加载提示 -->
    <div class="loading" id="loading">
      正在加载配置信息...
    </div>
  </div>

  <script>
    // 获取URL参数
    function getUrlParameter(name) {
      name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
      var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
      var results = regex.exec(window.location.search);
      return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    }

    // 加载配置文件
    async function loadConfig() {
      try {
        const gameId = getUrlParameter('game') || 'default';
        const response = await fetch('./config/games.json');
        const games = await response.json();
        const game = games.find(g => g.id === gameId) || games[0];
        if (navigator.userAgent.match(/mobile/i)) {
          window.location.replace(game.iframeSrc);
          return
        }
        renderPage(game);
        if (game.orientation === 0) {
          toggleOrientation(0);
        }
      } catch (error) {
        console.error('加载配置失败:', error);
        document.getElementById('loading').innerHTML = '加载配置失败，请检查配置文件';
        setTimeout(() => {
          window.location.href = './index.html';
        }, 3000);
      }
    }

    // 渲染页面
    function renderPage(game) {
      document.getElementById('container').innerHTML = `
        <!-- 手机模拟器 -->
        <div class="me-4 d-flex justify-content-center flex-0">
          <div class="phone-mockup position-relative">
            <div class="phone-notch"></div>
            <!-- 内嵌Demo（替换为你的实际项目URL） -->
            <iframe src="${game.iframeSrc || './ex/index.html'}" class="demo-frame" title="Mobile Demo"></iframe>
          </div>
        </div>
        <!-- 控制面板 -->
        <div class="p-4 bg-white rounded shadow-sm flex-1">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="main-title mb-0">${game.name}</h3>
            <!-- 返回主界面按钮 -->
            <a href="./index.html" class="btn btn-outline-primary">
              <i class="bi bi-house-door"></i> 返回主界面
            </a>
          </div>

          <div class="d-flex">
            <div>
              <label class="form-label">设备尺寸预设</label>
              <select class="form-select" id="deviceSelector" onchange="changeDevice(this.value)">
                <option value="375x667">iPhone 8 (375×667)</option>
                <option value="414x896">iPhone 12 (414×896)</option>
                <option value="360x800">Pixel 5 (360×800)</option>
                <option value="412x869">Pixel 7 (412×869)</option>
                <option value="375x812">iPhone X (375×812)</option>
                <option value="430x932">iPhone 14 Pro (430×932)</option>
              </select>
            </div>

            <div class="mx-3">
              <label class="form-label">操作</label>
              <div class="d-grid gap-2 d-md-flex">
                <!-- <button class="btn btn-outline-primary me-md-2" onclick="toggleOrientation()">
                  <i class="bi bi-arrow-clockwise"></i> 切换方向
                </button> -->
                <button class="btn btn-outline-secondary" onclick="document.querySelector('.demo-frame').src += ''">
                  <i class="bi bi-arrow-repeat"></i> 刷新页面
                </button>
              </div>
            </div>
          </div>

          <div class="mt-20px">
            <label class="form-label">使用说明</label>
            <div class="info-box">
              <ol class="mb-0">
                ${game.instructions.map(item => `<li>${item}</li>`).join('')}
              </ol>
            </div>
          </div>
          <div class="mt-20px">
            <label class="form-label">开发介绍</label>
            <div class="info-box">
              <ul class="mb-0">
                ${game.development.map(item => `<li>${item}</li>`).join('')}
              </ul>
            </div>
          </div>
        </div>
      `;

      // 重新绑定事件
      bindEvents();
    }

    // 绑定事件
    function bindEvents() {
      // 初始化设备选择器
      document.getElementById('deviceSelector').value = '375x667';
    }

    let orientation = 1; // 1: 竖屏 0: 横屏
    let currentWidth = 375;
    let currentHeight = 667;
    const container = document.querySelector('.container-wrap');

    // 切换横竖屏
    function toggleOrientation(or) {
      if (or || or === 0) {
        if (or === orientation) return
        orientation = or;
      } else {
        orientation = orientation === 1 ? 0 : 1;
      }
      const phone = document.querySelector('.phone-mockup');
      if (orientation === 1) {
        phone.style.height = `${currentHeight}px`;
        phone.style.width = `${currentWidth}px`;
        container.classList.remove('landscape');
      } else {
        phone.style.height = `${currentWidth}px`;
        phone.style.width = `${currentHeight}px`;
        container.classList.add('landscape');
      }
    }

    // 更改设备尺寸 
    function changeDevice(size) {
      const [width, height] = size.split('x');
      currentWidth = parseInt(width);
      currentHeight = parseInt(height);

      const phone = document.querySelector('.phone-mockup');
      if (orientation === 1) {
        phone.style.width = `${currentWidth}px`;
        phone.style.height = `${currentHeight}px`;
      } else {
        phone.style.width = `${currentHeight}px`;
        phone.style.height = `${currentWidth}px`;
      }
    }

    window.addEventListener('message', (event) => {
      if (event.data.type === 'orientation') {
        const or = event.data.data
        toggleOrientation(or)
      }
    });

    // 页面加载完成后加载配置
    document.addEventListener('DOMContentLoaded', loadConfig);
  </script>
</body>

</html>