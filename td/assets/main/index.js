System.register("chunks:///_virtual/ActionCard.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalEventMgr.ts","./Enum.ts","./GlobalDataMgr.ts"],(function(t){var e,i,n,a,r,c,s,o,h,l,u,d,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,c=t._decorator,s=t.Enum,o=t.Node,h=t.Component},function(t){l=t.default},function(t){u=t.ActionTypeEnum,d=t.EventEnum},function(t){f=t.default}],execute:function(){var C,m,p,v,k,y,E;r._RF.push({},"85078FrPUlNPZTs+eRVPtJF","ActionCard",void 0);var g=c.ccclass,N=c.property;t("ActionCard",(C=g("ActionCard"),m=N({type:s(u),tooltip:"选择卡片动作类型"}),p=N(o),C((y=e((k=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),c=0;c<i;c++)r[c]=arguments[c];return e=t.call.apply(t,[this].concat(r))||this,n(e,"actionType",y,a(e)),n(e,"mask",E,a(e)),e.timer=0,e.isNeedCheck=!1,e}i(e,t);var r=e.prototype;return r.init=function(){this.mask.active=!0,this.initEvents()},r.initEvents=function(){l.Instance.on(d.CardUse,this.checkCard,this),l.Instance.on(d.ActionCardUse,this.checkCard,this),this.node.on(o.EventType.TOUCH_END,this.onCardClick,this)},r.offEvents=function(){this.node.off(o.EventType.TOUCH_END,this.onCardClick,this),l.Instance.off(d.CardUse,this.checkCard,this),l.Instance.off(d.ActionCardUse,this.checkCard,this)},r.onCardClick=function(){this.mask.active=!0,l.Instance.emit(d.ActionCardClick,u.Dismantle),this.timer=0,this.isNeedCheck=!0},r.checkCard=function(){this.isNeedCheck=!1;var t=f.Instance.stage.getChildByName("towerRoots"),e=f.Instance.stage.getChildByName("towerRoots2");if(t||e){for(var i=!0,n=[].concat(t.children,e.children),a=0;a<n.length;a++){var r=n[a].children.find((function(t){return t.name.startsWith("tower")}));if(r){i=!1;var c=r.children.find((function(t){return"dismantleBtn"===t.name}));c&&(c.active=!1)}}this.mask.active=i}else this.mask.active=!0},r.onDestroy=function(){this.offEvents()},r.update=function(t){this.isNeedCheck&&this.mask.active&&(this.timer+=t,this.timer>=10&&(this.mask.active=!1,this.timer=0,l.Instance.emit(d.ActionCardClick,u.Cancel)))},e}(h)).prototype,"actionType",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return u.None}}),E=e(k.prototype,"mask",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=k))||v));r._RF.pop()}}}));

System.register("chunks:///_virtual/AnState.ts",["cc"],(function(t){var n,e,a;return{setters:[function(t){n=t.cclegacy,e=t._decorator,a=t.Animation}],execute:function(){var i;n._RF.push({},"45804WYVl5Da7aSlPDYllYk","AnState",void 0);var s=e.ccclass;e.property,t("AnState",s("AnState")(i=function(){function t(t,n,e){void 0===e&&(e=""),this.fsm=t,this.basePath=n,this.state=e}var n=t.prototype;return n.runAction=function(){var t=this.fsm.getComponent(a),n=this.basePath+this.state;if(t){if(t.getState(n)&&t.getState(n).isPlaying)return;t.play(n)}},n.stateChange=function(){this.runAction()},t}())||i);n._RF.pop()}}}));

System.register("chunks:///_virtual/AudioMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Singleton.ts","./GlobalDataMgr.ts"],(function(o){var u,i,e,t,n,a,s,c,r,d;return{setters:[function(o){u=o.inheritsLoose,i=o.createClass},function(o){e=o.cclegacy,t=o.resources,n=o.AudioClip,a=o.Node,s=o.director,c=o.AudioSource},function(o){r=o.default},function(o){d=o.default}],execute:function(){e._RF.push({},"70ca7YP9RlJy4hPu3noMUU9","AudioMgr",void 0);o("default",function(o){function e(){var u;(u=o.call(this)||this)._audioSource=null,u._audioBgmSource=null,u._audioMap=new Map,u._preloadKeys=[];var i=new a("__audioMgr__");return s.getScene().addChild(i),s.addPersistRootNode(i),u._audioSource=i.addComponent(c),u._audioBgmSource=i.addComponent(c),u}u(e,o);var r=e.prototype;return r.play=function(o,u,i){var e=this;void 0===i&&(i=!1),o&&("string"==typeof o?this._audioMap.has(o)?this._playClip(this._audioMap.get(o),u,i):t.load(o,n,(function(t,n){t?console.error(t):(e._audioMap.set(o,n),e._playClip(n,u,i))})):this._playClip(o,u,i))},r.playOneShot=function(o,u){var i=this;o&&(o instanceof n?this._playOneShot(o,u):this._audioMap.has(o)?this._playOneShot(this._audioMap.get(o),u):t.load(o,n,(function(e,t){e?console.error(e):(i._audioMap.set(o,t),i._playOneShot(t,u))})))},r.stop=function(){this._audioBgmSource.stop(),this._audioSource.stop()},r.pause=function(){this._audioBgmSource.pause(),this._audioSource.pause()},r.resume=function(){this._audioBgmSource.play(),this._audioSource.play()},r._playClip=function(o,u,i){void 0===i&&(i=!1),u=this.getMusicVolume(u),i?(this._audioBgmSource.loop=!0,this._audioBgmSource.stop(),this._audioBgmSource.clip=o,this._audioBgmSource.volume=u,this._audioBgmSource.play()):(this._audioSource.stop(),this._audioSource.clip=o,this._audioSource.volume=u,this._audioSource.play())},r.getSoundVolume=function(o){var u=d.Instance.userConfig;return u.isSoundMuted?0:(o||0===o||(o=u.sound||0===u.sound?u.sound:50),o/100)},r.getMusicVolume=function(o){var u=d.Instance.userConfig;return u.isMusicMuted?0:(o||0===o||(o=u.music||0===u.music?u.music:50),o/100)},r.changeVolume=function(o){this._audioBgmSource.volume=o,this._audioSource.volume=o},r._playOneShot=function(o,u){u=this.getSoundVolume(u),this._audioSource.playOneShot(o,u)},r.preLoad=function(o){var u=this;new Promise((function(i,e){u._preloadKeys.includes(o)?i():(u._preloadKeys.push(o),t.loadDir(o,n,(function(t,n){t?(e(t),console.log("加载音频资源失败",o,t)):(console.log("加载音频资源成功",o,n),n.forEach((function(i){u._audioMap.set(o+i.name,i)})),i())})))}))},r.reset=function(){this._audioMap.clear(),this._preloadKeys=[],this.stop(),this._audioSource.clip=null},i(e,[{key:"audioSource",get:function(){return this._audioSource}},{key:"audioBgmSource",get:function(){return this._audioBgmSource}}],[{key:"Instance",get:function(){return o.GetInstance.call(this)}}]),e}(r));e._RF.pop()}}}));

System.register("chunks:///_virtual/Battle.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalDataMgr.ts","./index2.ts","./MapMgr.ts","./TowersMgr.ts","./GlobalEventMgr.ts","./Enum.ts","./UIMgr.ts","./WaveMgr.ts","./GameHeader.ts","./FaderManager.ts","./BottomTool.ts","./AudioMgr.ts","./UIDialog.ts","./Coin.ts","./SecureStorag.ts"],(function(e){var t,n,a,i,s,o,r,c,l,u,h,f,g,m,d,p,v,y,I,E,C,w,M,b,D,S,T,L,P,k,x,B,G,H,N,R,A,W,F;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,a=e.initializerDefineProperty,i=e.assertThisInitialized,s=e.asyncToGenerator,o=e.regeneratorRuntime},function(e){r=e.cclegacy,c=e._decorator,l=e.Prefab,u=e.Node,h=e.Vec3,f=e.instantiate,g=e.Tween,m=e.Component,d=e.director},function(e){p=e.default},function(e){v=e.deepClone,y=e.createNode,I=e.getPos,E=e.$t,C=e.loadJson,w=e.allSettled},function(e){M=e.MapMgr},function(e){b=e.TowersMgr},function(e){D=e.default},function(e){S=e.ResPathEnum,T=e.GameStateEnum,L=e.EventEnum,P=e.ScenceEnum},function(e){k=e.default,x=e.UIPanelName},function(e){B=e.default},function(e){G=e.GameHeader},function(e){H=e.default},function(e){N=e.BottomTool},function(e){R=e.default},function(e){A=e.DialogType},function(e){W=e.Coin},function(e){F=e.SecureStorage}],execute:function(){var z,_,U,O,V,j,J,$,q;r._RF.push({},"1ec8dkak3dFc7x173TAfxgW","Battle",void 0);var K=c.ccclass,Q=c.property;e("Battle",(z=K("Battle"),_=Q(l),U=Q(u),O=Q(u),z((J=t((j=function(e){function t(){for(var t,n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return t=e.call.apply(e,[this].concat(s))||this,a(t,"coinPrefab",J,i(t)),a(t,"stage",$,i(t)),a(t,"inputMask",q,i(t)),t.waitList=[],t.wavesTimer=null,t.waveMgr=null,t.gameHeader=null,t.bottomTool=null,t.levelData=null,t.coinTargetPos=new h(0,0,0),t}n(t,e);var r=t.prototype;return r.onLoad=function(){p.Instance.init(),R.Instance.play(S.BattleBgm,null,!0)},r.start=function(){var e=s(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p.Instance.stage=this.stage,this.waveMgr=this.node.getComponent(B),this.gameHeader=this.node.getChildByName("gameHeader").getComponent(G),this.coinTargetPos=I(this.gameHeader.node.getChildByName("left").getChildByName("coin"),this.stage),this.bottomTool=this.node.getChildByName("bottomTool").getComponent(N),this.init();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.getLevelData=function(){var e=s(o().mark((function e(){var t,n,a,i,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=p.Instance.userData.level||1,!this.levelData||this.levelData.name!==t){e.next=3;break}return e.abrupt("return");case 3:return n=""+S.Levels+t,e.next=6,C(n);case 6:(a=e.sent)&&a.str?(i=F.Instance.loadEncryptedFileData(a.str,"{}"),this.levelData=v(i)):(this.levelData=null,s=E("dialog.nextLevelError"),k.Instance.openDilog({content:s,type:A.Alert,closeFun:function(){k.Instance.onSceneChanged(),d.loadScene(P.Home)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.init=function(){var e=s(o().mark((function e(){var t,n,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.stopAll(),H.Instance.fadeIn(),e.next=4,this.getLevelData();case 4:if(this.levelData){e.next=7;break}return H.Instance.fadeOut(),e.abrupt("return");case 7:this.waitList=[],this.initLevel(),(n=this.stage.getComponent(M)).init(),(t=this.waitList).push.apply(t,n.waitList),this.gameHeader.init(),d.isPaused()&&(d.resume(),p.Instance.userConfig.isMusicMuted||R.Instance.resume()),this.bottomTool.init(),w(this.waitList).then((function(){a.initTowers(),a.initEvents(),a.initEnemy(),H.Instance.fadeOut(.2)}));case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),r.initLevel=function(){this.clearLevel(),p.Instance.money=this.levelData.money,p.Instance.life=this.levelData.life,p.Instance.levelData=v(this.levelData)},r.clearLevel=function(){this.stage.removeAllChildren(),p.Instance.reset(),D.Instance.clear()},r.nextLevel=function(){this.init()},r.initEnemy=function(){var e=y("enemyRoot");e.setScale(p.Instance.mapsScale,p.Instance.mapsScale);var t=this.stage.getChildByName("towerRoots").getSiblingIndex();this.stage.insertChild(e,t+1)},r.initTowers=function(){this.stage.addComponent(b).init()},r.gameStateChange=function(){switch(p.Instance.gameState){case T.Start:this.inputMask.active=!1,this.waveMgr.init();break;case T.Win:k.Instance.openPanel(x.WinPanel);break;case T.Fail:k.Instance.openPanel(x.FailPanel)}},r.onEntityDie=function(e,t,n,a){void 0===n&&(n=0),this.creatCoin(a,n),p.Instance.money+=n,t.startsWith("enemy")&&this.freeEnemy(e,t)},r.creatCoin=function(e,t){void 0===t&&(t=0);var n=f(this.coinPrefab);n.setPosition(e),n.getComponent(W).init(t,this.coinTargetPos),n.setParent(this.stage)},r.onMoneyChange=function(e){this.gameHeader.addRollValue(e)},r.onEnemyToEnd=function(){this.gameHeader.decreaseLife()},r.freeEnemy=function(e,t){this.waveMgr.freeEnemy(e,t),this.waveMgr.canCheckGameWin&&this.checkGameWin()},r.initEvents=function(){D.Instance.on(L.GameStateChange,this.gameStateChange,this),D.Instance.on(L.GameRestart,this.init,this),D.Instance.on(L.GameNextLevel,this.nextLevel,this),D.Instance.on(L.EnemyToEnd,this.onEnemyToEnd,this),D.Instance.on(L.EnemyAttackEnd,this.freeEnemy,this),D.Instance.on(L.EntityDie,this.onEntityDie,this),D.Instance.on(L.MoneyChange,this.onMoneyChange,this)},r.offEvents=function(){D.Instance.off(L.GameStateChange,this.gameStateChange,this),D.Instance.off(L.GameRestart,this.init,this),D.Instance.off(L.GameNextLevel,this.nextLevel,this),D.Instance.off(L.EnemyToEnd,this.onEnemyToEnd,this),D.Instance.off(L.EnemyAttackEnd,this.freeEnemy,this),D.Instance.off(L.EntityDie,this.onEntityDie,this),D.Instance.on(L.MoneyChange,this.onMoneyChange,this)},r.onDestroy=function(){g.stopAll(),this.offEvents()},r.checkGameWin=function(){if(p.Instance.gameState===T.Start){for(var e=this.stage.getChildByName("enemyRoot").children,t=0;t<e.length;t++){if(e[t].active)return}p.Instance.gameState=T.Win}},t}(m)).prototype,"coinPrefab",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$=t(j.prototype,"stage",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q=t(j.prototype,"inputMask",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V=j))||V));r._RF.pop()}}}));

System.register("chunks:///_virtual/BottomTool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalDataMgr.ts","./Enum.ts","./index2.ts","./data.ts","./CardMgr.ts","./UIMgr.ts","./ActionCard.ts","./index.ts","./SecureStorag.ts"],(function(t){var e,n,a,i,r,o,c,s,l,u,d,h,f,p,m,v,g,C,S,b,y,B,P,R;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,a=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,c=t.Node,s=t.Prefab,l=t.instantiate,u=t.Component},function(t){d=t.default},function(t){h=t.GameStateEnum,f=t.ResPathEnum},function(t){p=t.allSettled,m=t.loadAtlas,v=t.deepClone},function(t){g=t.default},function(t){C=t.CardMgr},function(t){S=t.default,b=t.UIPanelName},function(t){y=t.ActionCard},function(t){B=t.C_TowerUP2Cost,P=t.C_TowerUP3Cost},function(t){R=t.SecureStorage}],execute:function(){var w,I,z,D,T,k,F,L,_,A,E;r._RF.push({},"6a394CCS8ZFrYe9Cv4zKq+Z","BottomTool",void 0);var M=o.ccclass,U=o.property,q=R.Instance.loadEncryptedFileData(g,{});t("BottomTool",(w=M("BottomTool"),I=U(c),z=U(c),D=U(c),T=U(s),w((L=e((F=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).cardRoot=null,a(e,"startBtn",L,i(e)),a(e,"quickBtn",_,i(e)),a(e,"dismantleCard",A,i(e)),a(e,"cardPrefab",E,i(e)),e.cardSps=null,e.waitList=[],e}n(e,t);var r=e.prototype;return r.start=function(){this.loadResource()},r.init=function(){var t=this;this.cardRoot=this.node.children[0],d.Instance.gameState==h.Ready?(this.startBtn.children[0].active=!0,this.startBtn.children[1].active=!1,this.cardRoot.active=!1,this.dismantleCard.active=!1):(this.startBtn.children[0].active=!1,this.startBtn.children[1].active=!0,this.dismantleCard.active=!0,this.cardRoot.active=!0),this.cardSps?this.initCards():p(this.waitList).then((function(){console.log("加载游戏卡片相关资源完成"),t.initCards()})),this.dismantleCard.getComponent(y).init()},r.loadResource=function(){var t=this,e=m(f.UICard).then((function(e){console.log("加载游戏卡片相关资源成功"),t.cardSps=e}));this.waitList.push(e)},r.initCards=function(){var t=this,e=this.cardRoot.children[0].children[0];e.removeAllChildren();var n=d.Instance,a=n.levelData,i=n.userData;if(a){var r=d.Instance.getLevelCards(),o=i.tower||{1:1};r.tower.forEach((function(n){var a=v(q[n]);a.grade=o[n]||1,2===a.grade?a.cost=a.cost*B:3===a.grade&&(a.cost=a.cost*P);var i=l(t.cardPrefab);i.getComponent(C).init(t.cardSps.getSpriteFrame(a.bg),t.cardSps.getSpriteFrame(a.icon),a),i.setParent(e)}))}},r.onStartClick=function(){d.Instance.gameState==h.Ready?(d.Instance.gameState=h.Start,this.startBtn.children[0].active=!1,this.startBtn.children[1].active=!0,this.cardRoot.active=!0,this.dismantleCard.active=!0):d.Instance.gameState==h.Start&&S.Instance.openPanel(b.PausePanel)},r.onQuickClick=function(){},e}(u)).prototype,"startBtn",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=e(F.prototype,"quickBtn",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=e(F.prototype,"dismantleCard",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(F.prototype,"cardPrefab",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=F))||k));r._RF.pop()}}}));

System.register("chunks:///_virtual/cardData.ts",["cc"],(function(V){var U;return{setters:[function(V){U=V.cclegacy}],execute:function(){U._RF.push({},"382fdccRJ5HYIESCmITuetQ","cardData",void 0);V("default","KhlONgYcAEdcR1VrUElVGw0BB05lVF9MFhIEFn1IPkdDRV1QMSJJCEwMBQoKfUhHRV9WXUAYJhUWTF9USUYsBgQFTU4qUEBtSUAzGEoeRjYRChlNTlNSVH1JURocFgBGZUFJVRwAEBBOZT5AQlZKUTkiXh5VBhceDE5lR0FaR0pHECYCAFVVQF1AHysEAUxfPVFIa15QKhJYCkAFPAodTF9EVF19XkcDFgQUQFZqSVEdEQcXRmUpUFtaWEc/EXMeUQcGCQtGZVBURE1YUxYVLwBRVFNKRxcrExdVVS9HTlpzUi4TSR1HDTwdC1VVVkFVTnNHBxcVA0deaF5HBBsVA0BWBFJfWUleOBlzCUceDBsfQFZ9VUFMSUQRHS8XR01XWFMRGD4XUVQ+Xklcc0s4CkMPUwsPMAtRVEdUVEZzUBEOHxFTWFVzRwAaBBRHXgRLSU5DRUE/EXMeUQcGCQtGZVBUQk1YUxYVLwBRVFRWSUYsBgQFTU4qU1xzVENCVFc4GXMJRx4MGx9AVn1VSkxJRBEdLxdHTV5FXUAfKwQBTF89VFVzQ1RbXkYsH0AkRxoNCghHXn1CVlVDVgUbHDpHSV9XSkcXKxMXVVUvQFBAbldfX1Y7GDk=");U._RF.pop()}}}));

System.register("chunks:///_virtual/CardMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Cool.ts","./GlobalEventMgr.ts","./Enum.ts","./GlobalDataMgr.ts"],(function(t){var e,n,i,a,r,o,c,s,l,u,h,d,f,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,i=t.initializerDefineProperty,a=t.assertThisInitialized},function(t){r=t.cclegacy,o=t._decorator,c=t.Label,s=t.Sprite,l=t.Node,u=t.Component},function(t){h=t.Cool},function(t){d=t.default},function(t){f=t.EventEnum},function(t){p=t.default}],execute:function(){var C,g,v,m,b,y,w,D,I,E,S,k,M,T,x,z,U;r._RF.push({},"79452aFUSBN77pPQjz/Ka5j","CardMgr",void 0);var F=o.ccclass,_=o.property;t("CardMgr",(C=F("CardMgr"),g=_(c),v=_(c),m=_(h),b=_(s),y=_(l),w=_(l),D=_(l),C((S=e((E=function(t){function e(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r))||this,i(e,"text1",S,a(e)),i(e,"text2",k,a(e)),i(e,"cool",M,a(e)),i(e,"icon",T,a(e)),i(e,"mask",x,a(e)),i(e,"unSelected",z,a(e)),i(e,"light",U,a(e)),e.cardData=null,e}n(e,t);var r=e.prototype;return r.init=function(t,e,n){this.node.getComponent(s).spriteFrame=t,this.icon.spriteFrame=e,this.cardData=n,this.cardData.name="tower"+n.type,this.text1.string=n.cost.toString(),this.text2.string=n.cost.toString(),this.cool.cooldown=n.cooldown,this.checkCardCost(),this.initEvents()},r.initEvents=function(){d.Instance.on(f.MoneyChange,this.onMoneyChange,this),d.Instance.on(f.CardUse,this.onCardUse,this),this.node.on(l.EventType.TOUCH_END,this.onCardClick,this)},r.offEvents=function(){this.node.off(l.EventType.TOUCH_END,this.onCardClick,this),d.Instance.off(f.CardUse,this.onCardUse,this),d.Instance.off(f.MoneyChange,this.onMoneyChange,this)},r.onCardClick=function(){this.node.parent.children.forEach((function(t){t.children.find((function(t){return"Light"===t.name})).active=!1,t.children.find((function(t){return"unSelected"===t.name})).active=!0})),this.unSelected.active=!1,this.light.active=!0;var t=!1;p.Instance.currentTowerCard||(t=!0),p.Instance.currentTowerCard=this.cardData.name,p.Instance.preTowerCard=this.cardData.name,t&&d.Instance.emit(f.CardFirstClick)},r.onMoneyChange=function(){this.checkCardCost()},r.checkCardCost=function(){p.Instance.money>=this.cardData.cost?(this.text1.node.active=!1,this.text2.node.active=!0,this.mask.active=!1,p.Instance.currentTowerCard===this.cardData.name&&(this.unSelected.active=!1,this.light.active=!0)):(this.light.active=!1,this.unSelected.active=!0,this.mask.active=!0,this.text2.node.active=!1,this.text1.node.active=!0)},r.onCardUse=function(t,e){e==this.cardData.name&&(p.Instance.currentTowerCard=null,this.light.active=!1,this.unSelected.active=!0,this.openCoolDown())},r.openCoolDown=function(){var t=this;this.cool.init((function(){p.Instance.preTowerCard===t.cardData.name&&(p.Instance.currentTowerCard=t.cardData.name,t.light.active=!0,t.unSelected.active=!1)}))},r.onDestroy=function(){this.offEvents()},e}(u)).prototype,"text1",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(E.prototype,"text2",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(E.prototype,"cool",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=e(E.prototype,"icon",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=e(E.prototype,"mask",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(E.prototype,"unSelected",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),U=e(E.prototype,"light",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=E))||I));r._RF.pop()}}}));

System.register("chunks:///_virtual/Coin.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./Enum.ts"],(function(t){var n,i,e,o,s,r,a,c,u,h,l,p,f,d;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.inheritsLoose,e=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){s=t.cclegacy,r=t._decorator,a=t.Label,c=t.Vec3,u=t.tween,h=t.lerp,l=t.Component},function(t){p=t.default},function(t){f=t.ResPathEnum,d=t.UITypeEnum}],execute:function(){var y,_,g,P,v;s._RF.push({},"81eedOkgUlMuKcG+11JIAzj","Coin",void 0);var M=r.ccclass,m=r.property;t("Coin",(y=M("Coin"),_=m(a),y((v=n((P=function(t){function n(){for(var n,i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return n=t.call.apply(t,[this].concat(s))||this,e(n,"coin",v,o(n)),n.canMove=!1,n.targetPos=null,n._t=0,n._startPos=new c,n}i(n,t);var s=n.prototype;return s.init=function(t,n){this.targetPos=n,this.canMove=!1,this._t=0,this._startPos=this.node.position.clone(),this.coin.string=t.toString(),p.Instance.playOneShot(f.UISound+d.Coin),this.canMove=!0,u(this.node).to(1,{scale:new c(.5,.5,1)}).start()},s.update=function(t){if(this.canMove&&this._t<1){this._t+=t;var n=Math.min(this._t,1),i=h(this._startPos.x,this.targetPos.x,n),e=h(this._startPos.y,this.targetPos.y,n)+150*Math.sin(n*Math.PI);this.node.setPosition(i,e),this._t>=1&&this.node.destroy()}},n}(l)).prototype,"coin",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g=P))||g));s._RF.pop()}}}));

System.register("chunks:///_virtual/Cool.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,i,r,o,a,l,s,p,c,u,h;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,r=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,l=e.SpriteFrame,s=e.Sprite,p=e.Mask,c=e.CCFloat,u=e.tween,h=e.Component}],execute:function(){var m,f,d,b,k,g,y,S,v,C,w;o._RF.push({},"fcaeceFXhNEnohJuYbQbuhd","Cool",void 0);var F=a.ccclass,z=a.property;e("Cool",(m=F("Cool"),f=z(l),d=z(s),b=z(p),k=z(c),m((S=t((y=function(e){function t(){for(var t,n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return t=e.call.apply(e,[this].concat(o))||this,i(t,"maskShape",S,r(t)),i(t,"maskSprite",v,r(t)),i(t,"mask",C,r(t)),i(t,"cooldown",w,r(t)),t.parentNode=null,t}n(t,e);var o=t.prototype;return o.onLoad=function(){this.maskShape?this.mask.getComponent(s).spriteFrame=this.maskShape:(this.parentNode=this.node.parent,this.mask.getComponent(s).spriteFrame=this.parentNode.getComponent(s).spriteFrame)},o.init=function(e){var t=this;this.maskSprite.fillRange=1,this.node.active=!0,u(this.maskSprite).to(this.cooldown||2,{fillRange:0}).call((function(){t.node.active=!1,e&&e()})).start()},o.update=function(e){},t}(h)).prototype,"maskShape",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(y.prototype,"maskSprite",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(y.prototype,"mask",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=t(y.prototype,"cooldown",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),g=y))||g));o._RF.pop()}}}));

System.register("chunks:///_virtual/data.ts",["cc"],(function(V){var R;return{setters:[function(V){R=V.cclegacy}],execute:function(){R._RF.push({},"49815CJIiVPI6rskIifCajD","data",void 0);V("default","CkBdfV8ITBEfFQF9SFRbTRUFFg08DlFUVFZJRjYRChlNTlNTWH1JUQ0KFRFGZUNVR0NWHgQKLAAHTF9TVUh9EAJVVVZDVE5zRwEPCwEARmVASVUMGx4OCDASHUxfVBhIfUBHTRRWBRscOkdJXElEBBArEwYcTU5AUEB9DBABC0RfRm1CR1tNFx4RGH1fQlxVSkcLORQWEhtWS1dcc0cRCUdcR1ZpUElVHRUfBQl9X0FCRwUKCzMWCgABVktREXNHQExfHUcQJgIAVVVHXUANKxESDQ5EX1VqXkceDBsfQFZ9VUtMSUQGCywGR01eQUFOTjADFR0AEkdeakJJVQ0TU1hObVNRQkcUBAo4F0dNXVhTAQMwCRcBEghHXmsPSVVbVksZTiscAwtHXFFIfRMRAw4XGkBWbl1fTAwFCgp9SEdFW1ZdQA8wFgdMX1ddVHNQChEJBxQWTmVXQ0JHBAJGZVBXQU1YUxANMQIWTF9USUY8HQobCxsGDE5lUA5CR1NHXiRQEQ4fEVNYWXNHEhoRBwYPfUhQW00dEg0CfV9RX1xESUY8HRYDTU5AUFxzRxwIAxUAEH1IVkJDVhMFTmVHQVlHSkcWPhwCEk1OQkxZc0cQAQoKAQsoHEdNXAldQFp9XwhMER8VAX1IU1tNFQUWDTwOUVRdSkcNPB0LVVVWQFFOc0cQARYSR15uQVVbTRsXBB86EVFUVlNJRj0VR01NRkZAQH0XEgACA0debFxQW00XHg0AOwoEAEdcVhlzUFJVVQ9TFhUvAFFUUkpHBSsGBBQEVktTXnNHGg0KCEdefUJSVUNWEg0fK0dJX1NWSUYwFAMECgBTWF9qSVEMAkRfRm1FR1tNBhAMCzpHSV1LU0lGPB0KGwsbBgxOZVEOQkdeR14kUBEOHxFTWFRzRxIaEQcGD31IV0dDVhgBAzFHSUxVVEdIfREKBBtWS1Bcb0lRAQMAFgErUF9EX1hTAAt9X1FcUkRJRi0TCxAKVktRQH0GHAEJAgoTMVBfQhJYU1tOZR5RGhwWAEZlS0lVDgAFAw80R0lfUEpHDTwdC1VVVkNTTnNHEAEWEkdebkdVW00bFwQfOhFRVFFWSUY9FUdNTUZGQEB9FxIAAgNHXmteRxQAGx0GAygLUVRQG0lGbkJHTRRWBRscOkdJX1VKRwUrBgQUBFZLU1tzRxoNCghHXn1DUFVDVhINHytHSV9SVklGMBQDBAoAU1hYb0lRDAJEX0ZtRUdbTQYQDAs6R0laSUQGCzAeARgYGlNYWSJJUV9URF8ffQYcBwpWS1Ndc0cSGhEHBg99SFdHQ1YYAQMxR0lMVV9HSH0RCgQbVktQXG9JUQEDABYBK1BfQ19YUwALfV9RXFJESUYtEwsQClZLVkB9BhwBCQIKEzFQX0ESWFNTXn1fCEwRHxUBfUhURUNWEBYYPgYYTF9UV0h9GwYYAVZLQFxsR19MBgkWEH1IV0VfWFMNCjkWFhpHXFBUc1AHEE1OU1BbfUlRHAQIAgF9SFFbTRceDQA7CgQAR1xdGSI=");R._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyAnimationState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts","./EntityAnimationState.ts"],(function(t){var n,e,a,i,o;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy},function(t){a=t.ResPathEnum,i=t.ParamsNameEnum},function(t){o=t.EntityAnimationState}],execute:function(){e._RF.push({},"48dbd3jemZKPrtZKSa3ZNeq","EnemyAnimationState",void 0);t("EnemyAnimationState",function(t){function e(){for(var n,e=arguments.length,o=new Array(e),u=0;u<e;u++)o[u]=arguments[u];return(n=t.call.apply(t,[this].concat(o))||this).basePath=a.Enemy,n.states=[i.Idle,i.Walk,i.Attack,i.Hurt,i.Die],n.defaultState=i.Walk,n}return n(e,t),e}(o));e._RF.pop()}}}));

System.register("chunks:///_virtual/EnemyMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./EntityMgr.ts","./index2.ts","./EnemyAnimationState.ts","./Enum.ts","./GlobalDataMgr.ts","./GlobalEventMgr.ts","./AudioMgr.ts"],(function(t){var n,e,i,s,o,a,r,h,c,f,u,p,l,d,m,y,g,v,E,I,P,x,M,S,A;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,i=t.initializerDefineProperty,s=t.assertThisInitialized,o=t.createClass},function(t){a=t.cclegacy,r=t._decorator,h=t.ProgressBar,c=t.EffectAsset,f=t.Sprite,u=t.Animation,p=t.Material,l=t.Color,d=t.tween},function(t){m=t.default},function(t){y=t.getUid,g=t.allSettled},function(t){v=t.EnemyAnimationState},function(t){E=t.ParamsNameEnum,I=t.ResPathEnum,P=t.EnemyShaderType,x=t.EventEnum},function(t){M=t.default},function(t){S=t.default},function(t){A=t.default}],execute:function(){var C,D,k,w,H,b,B;a._RF.push({},"ad514d99xpJPodgaoLV5XXW","EnemyMgr",void 0);var F=r.ccclass,T=r.property;t("EnemyMgr",(C=F("EnemyMgr"),D=T(h),k=T(c),C((b=n((H=function(t){function n(){for(var n,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return n=t.call.apply(t,[this].concat(o))||this,i(n,"hpBar",b,s(n)),i(n,"effect",B,s(n)),n.mat=null,n._hp=0,n.currentIndex=1,n.isMoving=!1,n.enemyConfig=null,n.offset={x:0,y:0},n}e(n,t);var a=n.prototype;return a.init=function(t){var n=this;this.id=y(),this.render();var e=t.type;this.type="enemy"+e,this.enemyConfig={hp:50+10*e,speed:50+5*e,reward:20+5*(e-1)},this.currentIndex=1,this.fsm||(this.fsm=this.node.addComponent(v),this.fsm.init(this.type)),this.node.active=!1,this.hpBar.node.active=!1,g(this.fsm.waitList).then((function(){var t=M.Instance.startPoint;n.pos.x=t.x,n.pos.y=t.y,n.targetPos.x=t.x,n.targetPos.y=t.y,n.setEntityPosition(),n.hp=n.enemyConfig.hp,n.node.active=!0,n.spawnAnimation()})),this.initEvents()},a.spawnAnimation=function(){var t=this;this.state=E.Idle;var n=this.node.getComponent(f);A.Instance.playOneShot(I.EnemySound+"spawn"),n&&this.changeMat(P.Show,1,(function(){t.hpBar.node.active=!0,t.state=E.Walk}))},a.update=function(t){if(this.state===E.Walk){var n=M.Instance.pathPoints;if(n.length>0&&this.currentIndex<=n.length-1&&!this.isMoving){var e=n[this.currentIndex];this.targetPos.x=e.x,this.targetPos.y=e.y,this.isMoving=!0}this.move(t)}},a.move=function(t){var n=this.targetPos.clone().subtract(this.pos),e=n.length(),i=this.enemyConfig.speed*t;if(e<=i)return this.pos.x=this.targetPos.x,this.pos.y=this.targetPos.y,this.currentIndex++,this.isMoving=!1,this.currentIndex===M.Instance.pathPoints.length&&(this.state=E.Attack,A.Instance.playOneShot(I.EnemySound+E.Attack),S.Instance.emit(x.EnemyToEnd,this.node,this.type)),void this.setEntityPosition();n.normalize(),this.pos.add(n.multiplyScalar(i)),this.setEntityPosition()},a.setEntityPosition=function(){var t=this.targetPos.x-this.pos.x>=0;1===this.currentIndex&&M.Instance.pathPoints.length>0&&(t=M.Instance.pathPoints[1].x-this.pos.x>=0),this.node.setScale(t?1:-1,1),this.hpBar.node.setScale(t?1:-1,1),this.node.setPosition(this.pos.x+this.offset.x,this.pos.y+this.offset.y)},a.initEvents=function(){var t=this;S.Instance.on(x.ProjectileAttack,this.onHurt,this);var n=this.node.getComponent(u);n.on(u.EventType.FINISHED,(function(){if(t.state===E.Attack)return t.toAttacked(),void n.off(u.EventType.FINISHED);if(t.state===E.Die){var e=t.node.getPosition();return S.Instance.emit(x.EntityDie,t.node,t.type,t.enemyConfig.reward,e),void n.off(u.EventType.FINISHED)}t.state!==E.Walk&&(t.state=E.Walk),t.changeMat(P.Normal)}))},a.onDestroy=function(){this.node.getComponent(u).off(u.EventType.FINISHED),this.offEvents()},a.onHurt=function(t,n,e){var i=this;void 0===e&&(e=P.Flash),this.id===t&&this.state!==E.Die&&(this.hp-=n,this.hp<=0?(this.state=E.Die,this.changeMat(e,null,(function(){i.onDie()}))):(this.state=E.Hurt,this.changeMat(e)))},a.onDie=function(){this.hpBar.node.active=!1,this.changeMat(P.Hide),this.offEvents()},a.offEvents=function(){S.Instance.off(x.ProjectileAttack,this.onHurt,this)},a.toAttacked=function(){var t=this;this.offEvents(),this.node.getComponent(f)&&(this.hpBar.node.active=!1,this.changeMat(P.Hide,.5,(function(){S.Instance.emit(x.EnemyAttackEnd,t.node,t.type)})))},a.render=function(){var t=this.getComponent(f);t||(t=this.node.addComponent(f))},a.changeMat=function(t,n,e){void 0===n&&(n=1.5),this.mat||(this.mat=new p,this.mat.initialize({effectAsset:this.effect}));var i=this.getComponent(f);if(i.customMaterial=this.mat,i.customMaterial.setProperty("methods",t),[P.Show,P.Hide].includes(t)){var s=new l(255,255,255);i.color=s,d({num:255}).delay(.0016).to(n,{num:0},{onUpdate:function(t){s.r=t.num,i.color=s}}).call((function(){e&&e()})).start()}else e&&e()},o(n,[{key:"hp",get:function(){return this._hp},set:function(t){this._hp=t,this.hpBar.progress=t/this.enemyConfig.hp}}]),n}(m)).prototype,"hpBar",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=n(H.prototype,"effect",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=H))||w));a._RF.pop()}}}));

System.register("chunks:///_virtual/EntityAnimationState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FSM.ts","./Enum.ts","./AnState.ts","./index2.ts","./index.ts"],(function(t){var n,e,i,a,o,s,r,c,u,h,p,m,d;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy,i=t.Animation,a=t.AnimationClip,o=t.animation,s=t.Sprite},function(t){r=t.FSM_PARAM_TYPE_ENUM,c=t.default},function(t){u=t.ParamsNameEnum},function(t){h=t.AnState},function(t){p=t.loadDir,m=t.sortSpriteFrame},function(t){d=t.C_AnimationSpeed}],execute:function(){e._RF.push({},"c3237NpIT9LOppSHlDiVZqy","EntityAnimationState",void 0);t("EntityAnimationState",function(t){function e(){for(var n,e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];return(n=t.call.apply(t,[this].concat(i))||this).type=void 0,n.animationCom=void 0,n.states=[],n.defaultState=u.Idle,n.basePath="",n.needLoadSource=!0,n}n(e,t);var c=e.prototype;return c.init=function(t){this.type=t,this.animationCom=this.node.getComponent(i),this.animationCom||(this.animationCom=this.node.addComponent(i)),this.initStates()},c.initStates=function(){var t=this,n=this.basePath+"/"+this.type+"/";this.needLoadSource?this.loadResource(n):n="",this.states.forEach((function(e){t.params.set(e,{type:r.TRIGGER,value:!1}),t.stateMachine.set(e,new h(t,n,e))}))},c.loadResource=function(t){var n=this,e=p(t).then((function(e){n.states.forEach((function(i){var o=[u.Idle,u.Walk].indexOf(i)>-1?a.WrapMode.Loop:a.WrapMode.Normal,s=e.filter((function(t){return t.name.startsWith(i)}));n.setAnimationClip(t+i,m(s),o)}))}));this.waitList.push(e)},c.setAnimationClip=function(t,n,e){if(null!=n&&n.length){var r=new o.ObjectTrack;r.path=(new o.TrackPath).toComponent(s).toProperty("spriteFrame");var c=n.map((function(t,n){return[d*n,t]}));r.channel.curve.assignSorted(c);var u=new a;u.name=t,u.duration=n.length*d,u.addTrack(r),u.wrapMode=e,this.getComponent(i).addClip(u)}},c.stateChange=function(t){this.stateMachine.get(t).stateChange()},e}(c));e._RF.pop()}}}));

System.register("chunks:///_virtual/EntityMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,r,n,i,o,s,a,c,u,l,p;return{setters:[function(t){e=t.applyDecoratedDescriptor,r=t.inheritsLoose,n=t.initializerDefineProperty,i=t.assertThisInitialized,o=t.createClass},function(t){s=t.cclegacy,a=t._decorator,c=t.CCString,u=t.Vec2,l=t.UITransform,p=t.Component}],execute:function(){var f,y,d,g,h;s._RF.push({},"6df02GX+l9HzpGKjI9xJ2Iq","EntityMgr",void 0);var m=a.ccclass,v=a.property;t("default",(f=m("EntityMgr"),y=v(c),f((h=e((g=function(t){function e(){for(var e,r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))||this).id=void 0,n(e,"type",h,i(e)),e.fsm=void 0,e.pos=new u(0,0),e.targetPos=new u(0,0),e._state=void 0,e.uITransform=void 0,e}return r(e,t),e.prototype.onLoad=function(){this.uITransform=this.node.getComponent(l)},o(e,[{key:"state",get:function(){return this._state},set:function(t){this._state=t,this.fsm.setParams(t,!0)}}]),e}(p)).prototype,"type",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=g))||d));s._RF.pop()}}}));

System.register("chunks:///_virtual/Enum.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"5ff63NA0y5BV7YdSmx4Jy0E","Enum",void 0);e("DirEnum",function(e){return e[e.Top=0]="Top",e[e.Right=1]="Right",e[e.Bottom=2]="Bottom",e[e.Left=3]="Left",e}({})),e("MapEnum",function(e){return e[e.Loess=1]="Loess",e[e.Grass=2]="Grass",e}({})),e("MapDecorationEnum",function(e){return e[e.Tree01=0]="Tree01",e[e.Stone01=1]="Stone01",e}({})),e("ResPathEnum",function(e){return e.Enemy="texture/enemies",e.Levels="levels/level",e.MapTile="levels",e.TileImgs="texture/tileImgs/tile",e.UICard="texture/ui/ui_card",e.TowerSound="sound/tower/",e.EnemySound="sound/enemy/",e.UISound="sound/ui/",e.WinSound="sound/win",e.FailSound="sound/fail",e.BattleBgm="sound/bgm",e.HomeBgm="sound/home",e}({})),e("PrefabPathEnum",function(e){return e.MapBg="prefab/map/bg",e.Tower="prefab/tower/",e.Enemy="prefab/enemy",e.Projectile="prefab/projectile",e.WavesTimer="prefab/ui/game/wavesTimer",e.UIPanel="prefab/ui/panel/",e.TowerUpgradeBtn="prefab/ui/game/upgradeBtn",e.TowerSelector="prefab/ui/game/towerSelector",e.TowerBuildBtn="prefab/ui/game/buildBtn",e.TowerDismantleBtn="prefab/ui/game/dismantleBtn",e}({})),e("ScenceEnum",function(e){return e.Battle="battle",e.Home="home",e.Loading="loading",e}({})),e("GameStateEnum",function(e){return e.Ready="ready",e.Start="start",e.Win="win",e.Fail="fail",e}({})),e("EventEnum",function(e){return e.ChangeLang="changeLang",e.EntityDie="entityDie",e.EnemyToEnd="enemyToEnd",e.EnemyAttackEnd="enemyAttackEnd",e.EnemySpawn="enemySpawn",e.ProjectileDie="projectileDie",e.ProjectileAttack="projectileAttack",e.GameRestart="gameRestart",e.GameStart="gameStart",e.GamePause="gamePause",e.GameResume="gameResume",e.GameNextLevel="gameNextLevel",e.GameStateChange="gameStateChange",e.MoneyChange="moneyChange",e.CardFirstClick="cardFirstClick",e.CardUse="cardUse",e.ActionCardUse="actionCardUse",e.ActionCardClick="actionCardClick",e.CurrentTowerCardChange="currentTowerCardChange",e}({})),e("ParamsNameEnum",function(e){return e.Build1="build1",e.Idle="idle",e.Walk="walk",e.Attack="attack",e.Die="die",e.Hurt="hurt",e.Build2="build2",e.Build3="build3",e}({})),e("EntityTypeEnum",function(e){return e.Tower1="tower1",e.Tower2="tower2",e.Tower3="tower3",e.Tower4="tower4",e.Enemy1="enemy1",e.Enemy2="enemy2",e.StartPoint="startPoint",e.EndPoint="endPoint",e}({})),e("TowerCategoryEnum",function(e){return e[e.Stone=0]="Stone",e[e.Bow=1]="Bow",e[e.Magic=2]="Magic",e[e.Buff=3]="Buff",e}({})),e("ActionTypeEnum",function(e){return e[e.None=0]="None",e[e.Dismantle=1]="Dismantle",e[e.Upgrade=2]="Upgrade",e[e.Build=3]="Build",e[e.Cancel=4]="Cancel",e}({})),e("TowerAudioClipEnum",function(e){return e[e.Build=0]="Build",e[e.Attack=1]="Attack",e[e.Explode=2]="Explode",e[e.Die=3]="Die",e[e.Lightning=4]="Lightning",e[e.Arrow=5]="Arrow",e}({})),e("UITypeEnum",function(e){return e.None="none",e.Button="click",e.Switch="switch",e.Slider="scroll",e.Coin="coin",e}({})),e("MoveType",function(e){return e[e.Throw=0]="Throw",e[e.Linear=1]="Linear",e[e.Lightning=2]="Lightning",e}({})),e("EnemyShaderType",function(e){return e[e.Show=0]="Show",e[e.Hide=1]="Hide",e[e.Normal=2]="Normal",e[e.Flash=3]="Flash",e[e.Venom=4]="Venom",e[e.Freeze=5]="Freeze",e[e.Thunder=6]="Thunder",e}({}));n._RF.pop()}}}));

System.register("chunks:///_virtual/Fader.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,i,s,o,n,a,h,r,l,c;return{setters:[function(t){e=t.inheritsLoose},function(t){i=t.cclegacy,s=t._decorator,o=t.view,n=t.BlockInputEvents,a=t.Graphics,h=t.UITransform,r=t.Color,l=t.math,c=t.Component}],execute:function(){var d;i._RF.push({},"eefccTJLgdOg7eswqjsdo3C","Fader",void 0);var u=s.ccclass,f=function(t){return t.IDLE="IDLE",t.FADE_IN="FADE_IN",t.FADE_OUT="FADE_OUT",t}(f||{});t("default",u("Fader")(d=function(t){function i(){for(var e,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))||this).block=void 0,e.ctx=void 0,e.oldTime=0,e.duration=1,e.fadeStatus=f.IDLE,e.fadeResolve=void 0,e.size=new l.Size,e}e(i,t);var s=i.prototype;return s.init=function(){this.size=o.getVisibleSize(),this.block=this.addComponent(n),this.ctx=this.addComponent(a);var t=this.getComponent(h);t.setAnchorPoint(.5,.5),t.setContentSize(this.size.width,this.size.height),this.setAlpha(1)},s.setAlpha=function(t){this.ctx.clear(),this.ctx.rect(0,0,this.size.width,this.size.height),this.ctx.fillColor=new r(0,0,0,255*t),this.ctx.fill(),this.block.enabled=1===t},s.fadeIn=function(t){var e=this;return void 0===t&&(t=1),this.setAlpha(0),this.duration=t,this.oldTime=0,this.fadeStatus=f.FADE_IN,new Promise((function(t){e.fadeResolve=t}))},s.fadeOut=function(t){var e=this;return void 0===t&&(t=.5),this.setAlpha(1),this.duration=t,this.oldTime=0,this.fadeStatus=f.FADE_OUT,new Promise((function(t){e.fadeResolve=t}))},s.mask=function(t){var e=this;return void 0===t&&(t=1),this.setAlpha(t),new Promise((function(t){setTimeout(t,1e3*e.duration)}))},s.update=function(t){if(this.fadeStatus!==f.IDLE){this.oldTime+=t;var e=this.oldTime/this.duration;switch(this.fadeStatus){case f.FADE_IN:e<1?this.setAlpha(e):(this.setAlpha(1),this.fadeStatus=f.IDLE,this.oldTime=0,this.fadeResolve(null));break;case f.FADE_OUT:e<1?this.setAlpha(1-e):(this.fadeStatus=f.IDLE,this.setAlpha(0),this.oldTime=0,this.fadeResolve(null))}}},i}(c))||d);i._RF.pop()}}}));

System.register("chunks:///_virtual/FaderManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Fader.ts","./Singleton.ts","./index2.ts"],(function(e){var t,n,r,a,i,o,u,d;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){r=e.cclegacy,a=e.RenderRoot2D,i=e.director},function(e){o=e.default},function(e){u=e.default},function(e){d=e.createNode}],execute:function(){r._RF.push({},"5cd85GDWj9OpZyREp7zmVui","FaderManager",void 0);e("default",function(e){function r(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this)._fader=null,t}t(r,e);var u=r.prototype;return u.fadeIn=function(e){return this.fader.fadeIn(e)},u.fadeOut=function(e){return this.fader.fadeOut(e)},u.mask=function(e){return void 0===e&&(e=1),this.fader.mask(e)},n(r,[{key:"fader",get:function(){if(null!==this._fader)return this._fader;var e=d("root");e.addComponent(a);var t=d("fader");return t.setParent(e),this._fader=t.addComponent(o),this._fader.init(),i.addPersistRootNode(e),this._fader}}],[{key:"Instance",get:function(){return e.GetInstance.call(this)}}]),r}(u));r._RF.pop()}}}));

System.register("chunks:///_virtual/FSM.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,a,n,r,s;return{setters:[function(t){e=t.inheritsLoose,a=t.createClass},function(t){n=t.cclegacy,r=t._decorator,s=t.Component}],execute:function(){var i;n._RF.push({},"43399pNWVZOGZYnHOBhbYYv","FSM",void 0);var c=r.ccclass;t("FSM_PARAM_TYPE_ENUM",function(t){return t.NUMBER="NUMBER",t.TRIGGER="TRIGGER",t}({})),t("default",c("FSM")(i=function(t){function n(){for(var e,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).params=new Map,e.stateMachine=new Map,e.waitList=[],e._currentState=void 0,e}e(n,t);var r=n.prototype;return r.getParams=function(t){if(this.params.has(t))return this.params.get(t).value},r.setParams=function(t,e){this.params.has(t)&&(this.params.get(t).value=e,this.paramsChange(t))},r.paramsChange=function(t){this.stateMachine.has(t)?this.currentState=this.stateMachine.get(t):this.stateChange(t)},a(n,[{key:"currentState",get:function(){return this._currentState},set:function(t){t&&t!==this._currentState&&(this._currentState=t,this._currentState.stateChange())}}]),n}(s))||i);n._RF.pop()}}}));

System.register("chunks:///_virtual/GameHeader.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalDataMgr.ts","./GlobalEventMgr.ts","./Enum.ts","./index2.ts"],(function(e){var t,n,i,o,r,s,a,l,u,c,h,v,f,g,d,p,m,y,w,b,P;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){r=e.cclegacy,s=e._decorator,a=e.Label,l=e.Node,u=e.ProgressBar,c=e.Slider,h=e.instantiate,v=e.UITransform,f=e.Tween,g=e.tween,d=e.Sprite,p=e.color,m=e.Component},function(e){y=e.default},function(e){w=e.default},function(e){b=e.EventEnum},function(e){P=e.$t}],execute:function(){var C,I,E,L,R,S,B,x,M,N,z,D,G;r._RF.push({},"af4d2GwJJBOgqcNMKhY+Pb9","GameHeader",void 0);var O=s.ccclass,j=s.property;e("GameHeader",(C=O("GameHeader"),I=j(a),E=j(l),L=j(l),R=j(l),S=j(a),C((M=t((x=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return t=e.call.apply(e,[this].concat(r))||this,i(t,"moneyLabel",M,o(t)),i(t,"lifeRoot",N,o(t)),i(t,"waveProgress",z,o(t)),i(t,"waveSliderButton",D,o(t)),i(t,"level",G,o(t)),t.rollValueObj={value:0},t.lifeNode=null,t.waveIconNode=null,t.enemyCount=0,t.currentEnemyIndex=0,t.waveProgressList=[],t}n(t,e);var r=t.prototype;return r.onLoad=function(){this.lifeNode=this.lifeRoot.children[0],this.waveIconNode=this.waveProgress.children[0].children[0]},r.initEvents=function(){w.Instance.on(b.EnemySpawn,this.updateWaveProgress,this)},r.offEvents=function(){w.Instance.off(b.EnemySpawn,this.updateWaveProgress,this)},r.onDestroy=function(){this.offEvents()},r.init=function(){this.initEvents(),this.level.string=P("home.levelText",[(y.Instance.userData.level||1)+""]),this.waveProgress.getComponent(u).progress=0,this.waveProgress.getComponent(c).progress=0,this.lifeRoot.removeAllChildren();for(var e=0;e<y.Instance.life;e++){var t=h(this.lifeNode);this.lifeRoot.addChild(t)}this.initMoneyLabel(),this.initWaveProgressBar()},r.initWaveProgressBar=function(){this.waveSliderButton.active=!1,this.waveProgressList=[],this.currentEnemyIndex=0,this.enemyCount=0,this.waveProgress.children[0].removeAllChildren();var e=this.waveProgress.getComponent(v).width,t=y.Instance.levelData.waves;if(t&&t.length>1){var n=0,i=[];t.forEach((function(e){var t=0;e.enemies.forEach((function(e){n+=e.count,t+=e.count})),i.push(t)})),this.enemyCount=n;for(var o=0,r=0;r<t.length;r++){var s=h(this.waveIconNode);if(0===r)s.setPosition(1*e/this.enemyCount,0),this.waveProgressList.push(1/this.enemyCount);else{var a=(o+=i[r-1])/this.enemyCount+1/this.enemyCount;this.waveProgressList.push(a),s.setPosition(e*a,0)}this.waveProgress.children[0].addChild(s)}this.waveProgress.active=!0}else this.waveProgress.active=!1},r.updateWaveProgress=function(e,t){this.waveSliderButton.active=!0;var n=1;void 0!==t?n=this.waveProgressList[t]:(this.currentEnemyIndex++,n=this.currentEnemyIndex/this.enemyCount),this.currentEnemyIndex>=this.enemyCount&&(n=1);var i=this.waveProgress.getComponent(u),o=this.waveProgress.getComponent(c);f.stopAllByTarget(i),g(i).to(e,{progress:n},{onUpdate:function(){o.progress=i.progress}}).call((function(){i.progress=n,o.progress=n})).start()},r.initMoneyLabel=function(){var e=y.Instance.money;this.rollValueObj.value=e,this.moneyLabel.string=e.toString()},r.addRollValue=function(e){var t=this,n=this.rollValueObj.value+e;g(this.rollValueObj).to(.5,{value:n},{easing:"sineOut",onUpdate:function(e,n){t.moneyLabel.string=Math.floor(e.value).toString()}}).call((function(){t.initMoneyLabel()})).start()},r.decreaseLife=function(){var e=this;if(!(y.Instance.life<=0)){var t=y.Instance.life-1;if(!(t<0||t>=this.lifeRoot.children.length)){var n=this.lifeRoot.children[t].getComponent(d);y.Instance.life--,g(n).to(.1,{color:p(255,255,255,255)}).to(.1,{color:p(255,255,255,0)}).to(.1,{color:p(255,255,255,255)}).to(.1,{color:p(255,255,255,0)}).call((function(){e.lifeRoot.children[t].active=!1})).start()}}},t}(m)).prototype,"moneyLabel",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=t(x.prototype,"lifeRoot",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=t(x.prototype,"waveProgress",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(x.prototype,"waveSliderButton",[R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=t(x.prototype,"level",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=x))||B));r._RF.pop()}}}));

System.register("chunks:///_virtual/GlobalDataMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Singleton.ts","./Enum.ts","./GlobalEventMgr.ts","./index2.ts"],(function(t){var e,n,i,s,u,r,a,o,c,f,g;return{setters:[function(t){e=t.inheritsLoose,n=t.createClass},function(t){i=t.cclegacy},function(t){s=t.default},function(t){u=t.GameStateEnum,r=t.DirEnum,a=t.EventEnum},function(t){o=t.default},function(t){c=t.initLang,f=t.getSysLocaleData,g=t.setSysLocaleData}],execute:function(){i._RF.push({},"6c834yYUXhKZZHiRVcccvkK","GlobalDataMgr",void 0);t("default",function(t){function i(){for(var e,n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))||this)._gameState=u.Ready,e.stage=null,e.mapsScale=1,e.gameSpeedScale=1,e.pathPoints=[],e.startPoint={x:0,y:0,dir:r.Right},e.endPoint={x:0,y:0},e._currentTowerCard=null,e.preTowerCard=null,e._money=200,e.levelData=null,e._life=0,e._userData=null,e._userConfig=null,e}e(i,t);var s=i.prototype;return s.reset=function(){this.gameState=u.Ready,this.gameSpeedScale=1,this.pathPoints=[],this.currentTowerCard=null},s.getLevelCards=function(){var t=[1],e=[];return this.userData.tower&&0===(t=Object.keys(this.userData.tower).map((function(t){return parseInt(t)}))).length&&(t=[1]),this.userData.buff&&(e=Object.keys(this.userData.buff).map((function(t){return parseInt(t)}))),{tower:t,buff:e}},s.init=function(){c(i.Instance.userConfig.language)},n(i,[{key:"gameState",get:function(){return this._gameState},set:function(t){this._gameState=t,o.Instance.emit(a.GameStateChange,t)}},{key:"currentTowerCard",get:function(){return this._currentTowerCard},set:function(t){this._currentTowerCard=t,o.Instance.emit(a.CurrentTowerCardChange,t)}},{key:"money",get:function(){return this._money},set:function(t){var e=t-this.money;this._money=t,o.Instance.emit(a.MoneyChange,e)}},{key:"life",get:function(){return this._life},set:function(t){this._life=t,this._life<=0&&(i.Instance.gameState=u.Fail)}},{key:"userData",get:function(){return this._userData||(this._userData=f()),this._userData},set:function(t){this._userData=t,g(t)}},{key:"userConfig",get:function(){return this._userConfig||(this._userConfig=f("userConfig"),this._userConfig.sound=void 0!==this._userConfig.sound?this._userConfig.sound:50,this._userConfig.music=void 0!==this._userConfig.music?this._userConfig.music:50,this._userConfig.isSoundMuted=void 0!==this._userConfig.isSoundMuted&&this._userConfig.isSoundMuted,this._userConfig.isMusicMuted=void 0!==this._userConfig.isMusicMuted&&this._userConfig.isMusicMuted),this._userConfig},set:function(t){this._userConfig=t,g(t,"userConfig")}}],[{key:"Instance",get:function(){return t.GetInstance.call(this)}}]),i}(s));i._RF.pop()}}}));

System.register("chunks:///_virtual/GlobalEventMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Singleton.ts"],(function(t){var e,n,a,c;return{setters:[function(t){e=t.inheritsLoose,n=t.createClass},function(t){a=t.cclegacy},function(t){c=t.default}],execute:function(){a._RF.push({},"0bc53r16yNDa7CrmfK86GOJ","GlobalEventMgr",void 0);t("default",function(t){function a(){for(var e,n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))||this)._eventMap=new Map,e}e(a,t);var c=a.prototype;return c.on=function(t,e,n){this._eventMap.has(t)?this._eventMap.get(t).push({callback:e,ctx:n}):this._eventMap.set(t,[{callback:e,ctx:n}])},c.off=function(t,e,n){if(this._eventMap.has(t)){var a=this._eventMap.get(t),c=a.findIndex((function(t){return t.callback===e&&(!t.ctx||t.ctx===n)}));-1!==c&&a.splice(c,1)}},c.emit=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),a=1;a<e;a++)n[a-1]=arguments[a];if(this._eventMap.has(t)){var c=this._eventMap.get(t);c.forEach((function(t){var e=t.callback,a=t.ctx;a?e.apply(a,n):e.apply(void 0,n)}))}},c.clear=function(){this._eventMap.clear()},n(a,null,[{key:"Instance",get:function(){return t.GetInstance.call(this)}}]),a}(c));a._RF.pop()}}}));

System.register("chunks:///_virtual/HomeMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./FaderManager.ts","./Enum.ts","./GlobalDataMgr.ts","./UIMgr.ts","./index2.ts","./AudioMgr.ts","./GlobalEventMgr.ts"],(function(e){var n,t,a,o,r,l,c,i,s,u,f,d,p,g,h,v,m,L,y,I,b;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,a=e.initializerDefineProperty,o=e.assertThisInitialized,r=e.asyncToGenerator,l=e.regeneratorRuntime},function(e){c=e.cclegacy,i=e._decorator,s=e.Label,u=e.director,f=e.Component},function(e){d=e.default},function(e){p=e.ResPathEnum,g=e.EventEnum,h=e.ScenceEnum},function(e){v=e.default},function(e){m=e.default,L=e.UIPanelName},function(e){y=e.$t},function(e){I=e.default},function(e){b=e.default}],execute:function(){var T,M,x,E,P;c._RF.push({},"e02feT93G9EoYyc6tTOHjS1","HomeMgr",void 0);var H=i.ccclass,S=i.property;e("HomeMgr",(T=H("HomeMgr"),M=S(s),T((P=n((E=function(e){function n(){for(var n,t=arguments.length,r=new Array(t),l=0;l<t;l++)r[l]=arguments[l];return n=e.call.apply(e,[this].concat(r))||this,a(n,"levelLabel",P,o(n)),n}t(n,e);var c=n.prototype;return c.onLoad=function(){I.Instance.play(p.HomeBgm,null,!0),v.Instance.init(),b.Instance.on(g.ChangeLang,this.loadLevelText,this)},c.start=function(){u.preloadScene(h.Battle)},c.onEnable=function(){this.loadLevelText()},c.loadLevelText=function(){this.levelLabel.string=y("home.levelText",[(v.Instance.userData.level||1)+""])},c.handelStart=function(){var e=r(l().mark((function e(){return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.Instance.fadeIn(.5);case 2:m.Instance.onSceneChanged(),u.loadScene(h.Battle);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),c.handleToLevels=function(){m.Instance.openPanel(L.LevelsPanel)},c.handleToUpgrade=function(){m.Instance.openPanel(L.UpgradePanel)},c.onDestroy=function(){b.Instance.off(g.ChangeLang,this.loadLevelText,this)},n}(f)).prototype,"levelLabel",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=E))||x));c._RF.pop()}}}));

System.register("chunks:///_virtual/index.ts",["cc"],(function(e){var n;return{setters:[function(e){n=e.cclegacy}],execute:function(){n._RF.push({},"7dd6djTW7FGWai/HyiyXLWO","index",void 0);e("C_AnimationSpeed",1/8),e("C_WaveTimer",1.5),e("C_UK","tower_defense_lbq"),e("C_LevelsCount",12),e("C_TowerReward",.7),e("C_TowerUP2Cost",1.3),e("C_TowerUP3Cost",1.6),e("C_TowerL2Attack",1.2),e("C_TowerL3Attack",1.3),e("C_TowerL2Range",1.2),e("C_TowerL3Range",1.3),e("C_DecorIndexes",[[16,22,43],[22,28,23,38],[23,34,35,36,37,40],[28,32]]),e("C_TileSize",256),e("C_LanguageList",[{name:"English",value:"en"},{name:"简体中文",value:"zh"}]);n._RF.pop()}}}));

System.register("chunks:///_virtual/index2.ts",["cc","./LanguageData.ts","./index.ts","./GlobalDataMgr.ts","./SecureStorag.ts"],(function(n){var e,t,r,o,a,u,i,c,s,f,l,d,m,p,g,v,y,S;return{setters:[function(n){e=n.cclegacy,t=n.resources,r=n.AudioClip,o=n.SpriteFrame,a=n.SpriteAtlas,u=n.Prefab,i=n.JsonAsset,c=n.Layers,s=n.Node,f=n.UITransform,l=n.sys,d=n.Vec3},function(n){m=n.t,p=n.init,g=n.updateSceneRenderers},function(n){v=n.C_LanguageList},function(n){y=n.default},function(n){S=n.SecureStorage}],execute:function(){n({$t:function(n,e){var t=m(n);e&&e.forEach((function(n,e){t=t.replace("{"+e+"}",n)}));return t},deepClone:function n(e,t){void 0===t&&(t=new WeakMap);if(null===e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);var r=Array.isArray(e)?[]:{};for(var o in t.set(e,r),e)e.hasOwnProperty(o)&&(r[o]=n(e[o],t));return r},loadJson:function(n){return new Promise((function(e,r){t.load(n,i,(function(n,t){e(n?null:t.json)}))}))},loadPrefab:function(n){return new Promise((function(e,r){t.load(n,u,(function(n,t){n?(console.log("加载预制体失败",n),r(n)):e(t)}))}))},loadPrefabs:function(n){return new Promise((function(e,r){t.loadDir(n,u,(function(n,t){n?r(n):e(t)}))}))},loadSp:function(n){return new Promise((function(e,r){t.load(n+"/spriteFrame",o,(function(n,t){n?r(n):e(t)}))}))}}),e._RF.push({},"ecca7K1Rg1OvoQY05x1fDvq","index",void 0);n("random",(function(n,e){return Math.floor(Math.random()*(e-n)+n)})),n("loadAudios",(function(n){return new Promise((function(e,o){t.loadDir(n,r,(function(n,t){n?o(n):e(t)}))}))})),n("loadDir",(function(n){return new Promise((function(e,r){t.loadDir(n,o,(function(n,t){n?r(n):e(t)}))}))})),n("loadAtlas",(function(n){return new Promise((function(e,r){t.load(n,a,(function(n,t){n?r(n):e(t)}))}))}));var h=n("getUiLayer",(function(){return 1<<c.nameToLayer("UI_2D")})),D=(n("createNode",(function(n){var e=new s(n);e.addComponent(f);return e.layer=h(),e})),/\((\d+)\)/),P=function(n){var e;return parseInt((null==(e=n.match(D))?void 0:e[1])||"0")};n("sortSpriteFrame",(function(n){return n.sort((function(n,e){return P(n.name)-P(e.name)}))})),n("sortByName",(function(n){return n.sort((function(n,e){return n.name.match(/\d+/)-e.name.match(/\d+/)}))})),n("getUid",(function(n){var e=Math.random().toString(36).substr(2);return n?n+"-"+e:e})),n("allSettled",(function(n){return Promise.all(n.map((function(n){return Promise.resolve(n).then((function(n){return{status:"fulfilled",value:n}})).catch((function(n){return{status:"rejected",reason:n}}))})))}));n("getSysLocaleData",(function(n){void 0===n&&(n="userData");var e=n.split("").reverse().join(""),t=S.Instance.loadEncryptedData(e,btoa(unescape(encodeURIComponent(e))));if(!t)return{};try{return JSON.parse(t)}catch(n){return{tower:{1:1}}}})),n("setSysLocaleData",(function(n,e){void 0===e&&(e="userData");var t=e.split("").reverse().join("");S.Instance.saveEncryptedData(t,JSON.stringify(n),btoa(unescape(encodeURIComponent(t))))})),n("initLang",(function(n){if(!n){(n=y.Instance.userConfig.language)||(n=l.language),v.find((function(e){return e.value==n}))||(n=v[0].value),y.Instance.userConfig.language=n}p(n),g()})),n("getPos",(function(n,e){var t=n.getComponent(f).convertToWorldSpaceAR(d.ZERO);return e.getComponent(f).convertToNodeSpaceAR(t)}));e._RF.pop()}}}));

System.register("chunks:///_virtual/LanguageData.ts",["cc"],(function(e){var n,a;return{setters:[function(e){n=e.cclegacy,a=e.director}],execute:function(){e({init:t,t:function(e){var n=window;if(!n.languages)return e;for(var a=e.split("."),t=n.languages[r],u=0;u<a.length;u++)if(!(t=t[a[u]]))return"";return t||""},updateSceneRenderers:u}),n._RF.push({},"b3f01X4Ik5LEbIPKXZr3JWD","LanguageData",void 0);var r=e("_language","zh");e("ready",!1);function t(n){e("ready",!0),r=e("_language",n)}function u(){for(var e=a.getScene().children,n=[],r=0;r<e.length;++r){var t=e[r].getComponentsInChildren("LocalizedLabel");Array.prototype.push.apply(n,t)}for(var u=0;u<n.length;++u){var i=n[u];i.node.active&&i.updateLabel()}for(var o=[],g=0;g<e.length;++g){var c=e[g].getComponentsInChildren("LocalizedSprite");Array.prototype.push.apply(o,c)}for(var l=0;l<o.length;++l){var p=o[l];p.node.active&&p.updateSprite()}}window._languageData={get language(){return r},init:function(e){t(e)},updateSceneRenderers:function(){u()}},n._RF.pop()}}}));

System.register("chunks:///_virtual/LightningChain.ts",["./rollupPluginModLoBabelHelpers.js","cc","./AudioMgr.ts","./GlobalEventMgr.ts","./Enum.ts","./EntityMgr.ts","./GlobalDataMgr.ts","./index2.ts"],(function(t){var e,n,o,i,s,a,r,c,l,h,u,g,p,f,d,m,y,v;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t._decorator,i=t.v3,s=t.instantiate,a=t.UIOpacity,r=t.tween,c=t.Component},function(t){l=t.default},function(t){h=t.default},function(t){u=t.ResPathEnum,g=t.TowerAudioClipEnum,p=t.EventEnum,f=t.EnemyShaderType},function(t){d=t.default},function(t){m=t.default},function(t){y=t.createNode,v=t.getPos}],execute:function(){var j;n._RF.push({},"2c1c91DtSlMwJjowCu9+fKH","LightningChain",void 0);var C=o.ccclass;o.property,t("default",C("LightningChain")(j=function(t){function n(){for(var e,n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))||this).segmentLength=138,e.segments=[],e.projectileRoot=null,e}e(n,t);var o=n.prototype;return o.generate=function(t,e,n){this.clear();for(var o=e.clone().subtract(n).length(),a=Math.ceil(o/this.segmentLength),r=n.clone().subtract(e).normalize(),c=[e],l=1;l<a;l++){var h=i(e.x+r.x*l*this.segmentLength,e.y+r.y*l*this.segmentLength,e.z+r.z*l*this.segmentLength);c.push(h)}c.push(n);for(var u=0;u<c.length-1;u++){var g=s(t),p=c[u],f=c[u+1];g.setPosition(p.x,p.y),g.angle=180*Math.atan2(f.y-p.y,f.x-p.x)/Math.PI-90,this.node.addChild(g),this.segments.push(g)}},o.clear=function(){this.segments.forEach((function(t){return t.destroy()})),this.segments=[]},o.play=function(t,e,n,o){var i=this;this.projectileRoot=m.Instance.stage.getChildByName("projectileRoot"),this.projectileRoot||(this.projectileRoot=y("projectileRoot"),m.Instance.stage.addChild(this.projectileRoot));var s=v(e,this.projectileRoot);this.generate(n,t,s),l.Instance.play(u.TowerSound+"tower"+g.Lightning),this.segments.forEach((function(t,n){var s=t.getComponent(a);r(s).delay(.02*n).to(.03,{opacity:255}).delay(.24).to(.05,{opacity:0}).call((function(){n===i.segments.length-1&&h.Instance.emit(p.ProjectileAttack,e.getComponent(d).id,o,f.Thunder)})).start()}))},n}(c))||j);n._RF.pop()}}}));

System.register("chunks:///_virtual/LoadingMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts","./index2.ts","./GlobalDataMgr.ts"],(function(e){var r,t,n,i,o,a,l,s,u,c,g,p,d,f,b,y;return{setters:[function(e){r=e.applyDecoratedDescriptor,t=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){o=e.cclegacy,a=e._decorator,l=e.ProgressBar,s=e.Slider,u=e.Label,c=e.Node,g=e.resources,p=e.director,d=e.Component},function(e){f=e.ScenceEnum},function(e){b=e.$t},function(e){y=e.default}],execute:function(){var h,x,m,L,v,z,B,M,T,w,D;o._RF.push({},"c331bz+TEFCaa82RoN7AQLU","LoadingMgr",void 0);var F=a.ccclass,S=a.property;e("LoadingMgr",(h=F("LoadingMgr"),x=S(l),m=S(s),L=S(u),v=S(c),h((M=r((B=function(e){function r(){for(var r,t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return r=e.call.apply(e,[this].concat(o))||this,n(r,"progressBar",M,i(r)),n(r,"slider",T,i(r)),n(r,"loadingText",w,i(r)),n(r,"logo",D,i(r)),r}return t(r,e),r.prototype.onLoad=function(){var e=this;y.Instance.init(),this.logo.active=!0,this.loadingText.string=b("loading.text",["0.00"]),this.progressBar.progress=0,g.preloadDir("texture/",(function(r,t){e.progressBar.progress=r/t,e.slider.progress=r/t,e.loadingText.string=b("loading.text",[(r/t*100).toFixed(2)])}),(function(){p.loadScene(f.Home)}))},r}(d)).prototype,"progressBar",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=r(B.prototype,"slider",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=r(B.prototype,"loadingText",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=r(B.prototype,"logo",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=B))||z));o._RF.pop()}}}));

System.register("chunks:///_virtual/LocalizedLabel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LanguageData.ts"],(function(e){var t,i,r,n,o,a,l,c,s,u,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.inheritsLoose,r=e.initializerDefineProperty,n=e.assertThisInitialized,o=e.createClass},function(e){a=e.cclegacy,l=e._decorator,c=e.Component},function(e){s=e.ready,u=e.init,p=e.t}],execute:function(){var y,d,b,f,h,L;a._RF.push({},"edf98QH2D1AUoCrtQlbxFrU","LocalizedLabel",void 0);var g=l.ccclass,v=l.property,k=l.executeInEditMode;e("LocalizedLabel",(y=g("LocalizedLabel"),d=v({visible:!1}),b=v({displayName:"Key",visible:!0}),y(f=k((L=t((h=function(e){function t(){for(var t,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(t=e.call.apply(e,[this].concat(o))||this).label=null,r(t,"key",L,n(t)),t}i(t,e);var a=t.prototype;return a.onLoad=function(){s||u("zh"),this.fetchRender()},a.fetchRender=function(){var e=this.getComponent("cc.Label");if(e)return this.label=e,void this.updateLabel()},a.updateLabel=function(){this.label&&(this.label.string=p(this.key))},o(t,[{key:"_key",get:function(){return this.key},set:function(e){this.updateLabel(),this.key=e}}]),t}(c)).prototype,"key",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),t(h.prototype,"_key",[b],Object.getOwnPropertyDescriptor(h.prototype,"_key"),h.prototype),f=h))||f)||f));a._RF.pop()}}}));

System.register("chunks:///_virtual/LocalizedSprite.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LanguageData.ts"],(function(e){var t,i,r,n,a,o,p,s,c,u,l;return{setters:[function(e){t=e.applyDecoratedDescriptor,i=e.initializerDefineProperty,r=e.inheritsLoose,n=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,p=e.SpriteFrame,s=e.Component},function(e){c=e.ready,u=e.init,l=e._language}],execute:function(){var f,h,d,g,y,z,L,m,b,v,S;a._RF.push({},"c05c25C4xNAupWYMB93tIzp","LocalizedSprite",void 0);var F=o.ccclass,_=o.property,w=o.executeInEditMode,D=(f=F("LocalizedSpriteItem"),h=_({type:p}),f((y=t((g=function(){i(this,"language",y,this),i(this,"spriteFrame",z,this)}).prototype,"language",[_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"zh"}}),z=t(g.prototype,"spriteFrame",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=g))||d);e("LocalizedSprite",(L=F("LocalizedSprite"),m=_({type:D}),L(b=w((S=t((v=function(e){function t(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).sprite=null,i(t,"spriteList",S,n(t)),t}r(t,e);var a=t.prototype;return a.onLoad=function(){c||u("zh"),this.fetchRender()},a.fetchRender=function(){var e=this.getComponent("cc.Sprite");if(e)return this.sprite=e,void this.updateSprite()},a.updateSprite=function(){for(var e=0;e<this.spriteList.length;e++){var t=this.spriteList[e];if(t.language===l){this.sprite.spriteFrame=t.spriteFrame;break}}},t}(s)).prototype,"spriteList",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),b=v))||b)||b));a._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./AnState.ts","./FSM.ts","./Fader.ts","./Singleton.ts","./SubFSM.ts","./UIBase.ts","./index.ts","./EntityAnimationState.ts","./EntityMgr.ts","./EnemyAnimationState.ts","./EnemyMgr.ts","./TowerAnimationState.ts","./TowerMgr.ts","./data.ts","./MapMgr.ts","./TowersMgr.ts","./WaveMgr.ts","./AudioMgr.ts","./FaderManager.ts","./GlobalDataMgr.ts","./GlobalEventMgr.ts","./Projectile.ts","./ProjecttileEmiter.ts","./Battle.ts","./HomeMgr.ts","./LoadingMgr.ts","./Enum.ts","./Type.ts","./PausePanelMgr.ts","./UIDialog.ts","./UIFailPanel.ts","./UILevelsPanel.ts","./UIMgr.ts","./UISettings.ts","./UIUpgradePanel.ts","./UIWinPanel.ts","./cardData.ts","./ActionCard.ts","./BottomTool.ts","./CardMgr.ts","./Coin.ts","./Cool.ts","./GameHeader.ts","./NumLabel.ts","./TopTool.ts","./LightningChain.ts","./PlayUIAudio.ts","./SampleAnimationByTween.ts","./SecureStorag.ts","./index2.ts","./LanguageData.ts","./LocalizedLabel.ts","./LocalizedSprite.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MapMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts","./GlobalDataMgr.ts","./index2.ts","./index.ts","./GlobalEventMgr.ts"],(function(t){var e,a,i,n,r,s,o,h,c,d,l,p,f,u,m,y,g,v,M,w,S,I,x,z,b;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.inheritsLoose,i=t.initializerDefineProperty,n=t.assertThisInitialized,r=t.createForOfIteratorHelperLoose},function(t){s=t.cclegacy,o=t._decorator,h=t.Prefab,c=t.math,d=t.macro,l=t.view,p=t.Sprite,f=t.instantiate,u=t.Graphics,m=t.Color,y=t.Component},function(t){g=t.ResPathEnum,v=t.EventEnum},function(t){M=t.default},function(t){w=t.allSettled,S=t.loadDir,I=t.createNode},function(t){x=t.C_TileSize,z=t.C_DecorIndexes},function(t){b=t.default}],execute:function(){var C,P,E,D,L;s._RF.push({},"486f0I3jodA26in0gw00+xc","MapMgr",void 0);var T=o.ccclass,k=o.property;t("MapMgr",(C=T("MapMgr"),P=k(h),C((L=e((D=function(t){function e(){for(var e,a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r))||this,i(e,"bgPrefab",L,n(e)),e.waitList=[],e.mapAtlas=null,e.mapSize=new c.Size(0,0),e.mapType=null,e.scale=1,e.roadPoints=[],e}a(e,t);var s=e.prototype;return s.onLoad=function(){d.ENABLE_WEBGL_ANTIALIAS=!1},s.init=function(){var t=this,e=M.Instance.levelData;if(e&&e.mapInfo){if(this.mapType===e.mapInfo.mapType)return this.waitList=[],void this.createMap();this.mapType=e.mapInfo.mapType,this.loadResource(),w(this.waitList).then((function(){t.createMap()}))}this.initEvents()},s.loadResource=function(){var t=this,e=S(""+g.TileImgs+this.mapType).then((function(e){t.mapAtlas=e.sort((function(t,e){return t.name-e.name}))}));this.waitList.push(e)},s.getMapScale=function(){var t=l.getVisibleSize(),e=t.width/this.mapSize.width,a=(t.height-140)/this.mapSize.height,i=Math.min(e,a,1);this.scale=i,M.Instance.mapsScale=i},s.createMap=function(){this.roadPoints=[];var t=M.Instance.levelData.mapInfo;t&&t.layers&&(M.Instance.startPoint.dir=t.startDir,this.mapSize=new c.Size(t.width*x,t.height*x),this.getMapScale(),this.createBg(t.layers.bg),this.createMapLayers(t.layers.rivers,"rivers"),this.createMapLayers(t.layers.decor,"decor"),this.createMapLayers(t.layers.road,"road"),this.createMapLayers(t.layers.tower,"tower"),this.getTiledMapData(t.layers.path),this.createMapLayers(t.layers.decor2,"decor2"),this.checkIsNeedDecor()&&this.createRandomDecor())},s.checkIsNeedDecor=function(){var t=125*this.scale,e=l.getVisibleSize();return e.width-this.mapSize.width*this.scale>=2*t||e.height-this.mapSize.height*this.scale>=2*t+200},s.getRandomDecorArea=function(){var t=125*this.scale,e=l.getVisibleSize(),a=[];return e.width-this.mapSize.width*this.scale>=2*t&&(a.push({x1:-this.mapSize.width/2-t,x2:-e.width/2,y1:-e.height/2+t,y2:e.height/2-t}),a.push({x1:this.mapSize.width/2+t,x2:e.width/2,y1:-e.height/2+t,y2:e.height/2-t})),e.height-this.mapSize.height*this.scale>=2*t&&(a.push({y1:-this.mapSize.height/2-t,y2:-e.height/2+t,x1:-e.width/2,x2:e.width/2}),a.push({y1:this.mapSize.height/2+t,y2:e.height/2-t,x1:-e.width/2,x2:e.width/2})),a[Math.floor(Math.random()*a.length)]},s.checkIsFrontOrBack=function(t,e){var a=1/0,i=0;return this.roadPoints.forEach((function(e){var n=Math.abs(e.x-t);n<=x/2&&n<a&&(a=n,i=e.y)})),e<i-x/2?"front":"back"},s.createRandomDecor=function(){var t=z[this.mapType-1],e=[],a=this.node.getChildByName("decorRoots"),i=this.node.getChildByName("decor2Roots");if(a&&i)for(var n=0;n<20;n++){for(var s=void 0,o=void 0,h=0,c=!1;h<20&&!c;){var d=this.getRandomDecorArea(),l=d.x1,f=d.y1,u=d.x2,m=d.y2;s=Math.random()*(u-l)+l,o=Math.random()*(m-f)+f,c=!0;for(var y,g=r(e);!(y=g()).done;){var v=y.value,M=v.x-s,w=v.y-o;if(Math.sqrt(M*M+w*w)<60){c=!1;break}}h++}e.push({x:s,y:o});var S=I("decorRandom_"+n),x=S.addComponent(p),b=t[Math.floor(Math.random()*t.length)];x.spriteFrame=this.mapAtlas[b],S.setPosition(s,o),"front"===this.checkIsFrontOrBack(s,o)?i.addChild(S):a.addChild(S)}},s.createBg=function(t){var e=f(this.bgPrefab);e.getComponent(p).spriteFrame=this.mapAtlas[t],this.node.addChild(e)},s.createMapLayers=function(t,e){var a=this;if(t){var i=M.Instance.levelData.mapInfo.width,n=I(e+"Roots");n.setScale(this.scale,this.scale);var r=null;this.node.addChild(n),"tower"===e&&((r=I(e+"Roots2")).setScale(this.scale,this.scale),this.node.addChild(r)),t.forEach((function(t){var s=t[0],o=t[1],h=Math.floor(s/i),c=s%i,d=I(e+"_"+s),l=d.addComponent(p),f=-a.mapSize.width/2+(c*x+x/2),u=a.mapSize.height/2-(h*x+x/2);(d.setPosition(f,u),"road"===e&&a.roadPoints.push({x:f,y:u}),l.spriteFrame=a.mapAtlas[o-1],"tower"===e)?"back"===a.checkIsFrontOrBack(f,u)?n.addChild(d):r.addChild(d):n.addChild(d)}))}},s.getTiledMapData=function(t){var e=this;if(t){var a=t.map((function(t){if(t.x=t.x-e.mapSize.width/2,t.y=e.mapSize.height/2-t.y,t.data){var a=Math.floor(t.x/x)*x+x/2,i=Math.floor(t.y/x)*x+x/2;t.data.isStart?(M.Instance.startPoint.x=a,M.Instance.startPoint.y=i):t.data.isEnd&&(M.Instance.endPoint.x=a,M.Instance.endPoint.y=i)}return{x:t.x,y:t.y}}));M.Instance.pathPoints=a}},s.drawTest=function(){var t=I("roadPath");t.setScale(this.scale,this.scale),this.node.addChild(t);var e=t.addComponent(u);e.strokeColor=m.BLACK,e.lineWidth=10,M.Instance.pathPoints.forEach((function(t,a){0===a?e.moveTo(t.x,t.y):e.lineTo(t.x,t.y)})),e.stroke()},s.end=function(){},s.initEvents=function(){b.Instance.on(v.EnemyToEnd,this.end,this)},s.offEvents=function(){b.Instance.off(v.EnemyToEnd,this.end,this)},s.onDestroy=function(){this.offEvents()},e}(y)).prototype,"bgPrefab",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=D))||E));s._RF.pop()}}}));

System.register("chunks:///_virtual/NumLabel.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,r,n,i,a,s,o,u,l,c,p,f,g,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,r=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized,a=e.createClass},function(e){s=e.cclegacy,o=e._decorator,u=e.Prefab,l=e.SpriteFrame,c=e.CCString,p=e.CCInteger,f=e.instantiate,g=e.Sprite,b=e.Component}],execute:function(){var h,m,d,y,S,v,C,F,L,P,_;s._RF.push({},"76cdbNBKH9IUItRSbS9wROI","NumLabel",void 0);var w=o.ccclass,z=o.property;e("NumLabel",(h=w("NumLabel"),m=z(u),d=z([l]),y=z(c),S=z(p),h((F=t((C=function(e){function t(){for(var t,r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return t=e.call.apply(e,[this].concat(a))||this,n(t,"numPrefab",F,i(t)),n(t,"numSpriteFrames",L,i(t)),n(t,"defaultString",P,i(t)),n(t,"scale",_,i(t)),t._string="",t}r(t,e);var s=t.prototype;return s.onLoad=function(){this.string=this.defaultString},s.render=function(){if(this.node.removeAllChildren(),this.string)for(var e=0;e<this.string.length;e++){var t=this.string[e],r=f(this.numPrefab);r.setScale(this.scale,this.scale),r.setParent(this.node),r.getComponent(g).spriteFrame=this.numSpriteFrames[t]}},s.start=function(){},s.update=function(e){},a(t,[{key:"string",get:function(){return this._string},set:function(e){this._string=e,this.render()}}]),t}(b)).prototype,"numPrefab",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),L=t(C.prototype,"numSpriteFrames",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),P=t(C.prototype,"defaultString",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_=t(C.prototype,"scale",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),v=C))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/PausePanelMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIMgr.ts","./UIBase.ts","./AudioMgr.ts","./Enum.ts","./GlobalEventMgr.ts","./GlobalDataMgr.ts"],(function(e){var n,t,a,c,s,u,o,l,r,i,f,p;return{setters:[function(e){n=e.inheritsLoose},function(e){t=e.cclegacy,a=e._decorator,c=e.director},function(e){s=e.default,u=e.UIPanelName},function(e){o=e.UIBase},function(e){l=e.default},function(e){r=e.EventEnum,i=e.ScenceEnum},function(e){f=e.default},function(e){p=e.default}],execute:function(){var d;t._RF.push({},"2b8344cd6hAZZtV4Ld5AqbC","PausePanelMgr",void 0);var P=a.ccclass;a.property,e("PausePanelMgr",P("PausePanelMgr")(d=function(e){function t(){return e.apply(this,arguments)||this}n(t,e);var a=t.prototype;return a.show=function(){e.prototype.show.call(this),l.Instance.pause(),c.pause()},a.onResumeClick=function(){s.Instance.closePanel(u.PausePanel),c.resume(),p.Instance.userConfig.isMusicMuted||l.Instance.resume()},a.onRestartClick=function(){l.Instance.audioSource.clip=null,s.Instance.closePanel(u.PausePanel),f.Instance.emit(r.GameRestart)},a.onBackClick=function(){l.Instance.audioSource.clip=null,s.Instance.onSceneChanged(),c.loadScene(i.Home)},t}(o))||d);t._RF.pop()}}}));

System.register("chunks:///_virtual/PlayUIAudio.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts","./AudioMgr.ts"],(function(t){var n,e,o,i,r,u,a,c,p,s,l,y;return{setters:[function(t){n=t.applyDecoratedDescriptor,e=t.inheritsLoose,o=t.initializerDefineProperty,i=t.assertThisInitialized},function(t){r=t.cclegacy,u=t._decorator,a=t.Enum,c=t.Node,p=t.Component},function(t){s=t.UITypeEnum,l=t.ResPathEnum},function(t){y=t.default}],execute:function(){var d,f,I,U,h;r._RF.push({},"1709dkfWF9MBqOCS4xsV5d5","PlayUIAudio",void 0);var v=u.ccclass,m=u.property;t("PlayUIAudio",(d=v("PlayUIAudio"),f=m({type:a(s),tooltip:"选择UI音效类型"}),d((h=n((U=function(t){function n(){for(var n,e=arguments.length,r=new Array(e),u=0;u<e;u++)r[u]=arguments[u];return n=t.call.apply(t,[this].concat(r))||this,o(n,"UIType",h,i(n)),n}return e(n,t),n.prototype.onLoad=function(){var t=this;y.Instance.preLoad(l.UISound),this.node.on(c.EventType.TOUCH_END,(function(){y.Instance.playOneShot(l.UISound+t.UIType)}))},n}(p)).prototype,"UIType",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return s.Button}}),I=U))||I));r._RF.pop()}}}));

System.register("chunks:///_virtual/Projectile.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts","./GlobalEventMgr.ts","./EntityMgr.ts","./AudioMgr.ts","./index2.ts","./GlobalDataMgr.ts"],(function(t){var e,i,o,n,a,s,r,h,c,l,u,p,d,m,f,y,v,g,P,_,j;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){a=t.cclegacy,s=t._decorator,r=t.CCString,h=t.Vec3,c=t.Animation,l=t.lerp,u=t.Component},function(t){p=t.MoveType,d=t.ResPathEnum,m=t.TowerAudioClipEnum,f=t.EventEnum},function(t){y=t.default},function(t){v=t.default},function(t){g=t.default},function(t){P=t.createNode,_=t.getPos},function(t){j=t.default}],execute:function(){var C,I,T,w,E;a._RF.push({},"43cd5CVDupEKLcaJwYrh9DQ","Projectile",void 0);var x=s.ccclass,M=s.property;t("Projecttile",(C=x("Projecttile"),I=M(r),C((E=e((w=function(t){function e(){for(var e,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return(e=t.call.apply(t,[this].concat(a))||this).moveType=p.Throw,e.attack=30,o(e,"explodePath",E,n(e)),e.host=null,e.target=null,e._t=0,e._duration=.5,e._startPos=new h,e.animationCom=void 0,e.projectileRoot=null,e}i(e,t);var a=e.prototype;return a.onLoad=function(){this.projectileRoot=j.Instance.stage.getChildByName("projectileRoot"),this.projectileRoot||(this.projectileRoot=P("projectileRoot"),j.Instance.stage.addChild(this.projectileRoot)),this.animationCom=this.getComponent(c)},a.onEnable=function(){var t=this;this.moveType===p.Linear&&g.Instance.playOneShot(d.TowerSound+"tower"+m.Arrow),this.animationCom&&this.animationCom.on(c.EventType.FINISHED,(function(e,i){i.time=0,i.sample(),t.onDie()})),this.move()},a.onDie=function(){this.node.active=!1,this._t=0,y.Instance.emit(f.ProjectileDie,this.node,this.host.uuid),this.animationCom.off(c.EventType.FINISHED)},a.update=function(t){if(this.target&&this._t<1){if(!this.target.active)return void this.toAttack();var e=_(this.target,this.projectileRoot);this._t+=t/this._duration;var i,o,n=Math.min(this._t,1);if(this.moveType===p.Throw){i=l(this._startPos.x,e.x,n),o=l(this._startPos.y,e.y,n)+150*Math.sin(n*Math.PI),this.node.angle=180*Math.atan2(o-this.node.position.y,i-this.node.position.x)/Math.PI-90}else if(this.moveType===p.Linear){var a=h.subtract(new h,e,this.node.position).normalize();this.node.angle=180*Math.atan2(a.y,a.x)/Math.PI,i=l(this._startPos.x,e.x,n),o=l(this._startPos.y,e.y,n)}this.node.setPosition(i,o),this._t>=1&&(this.node.setPosition(e.x,e.y),this.toAttack())}},a.move=function(){this._t=0,this._startPos=this.node.position.clone()},a.toAttack=function(){this._t=1,this.moveType===p.Throw?(this.animationCom.play(),g.Instance.playOneShot(this.explodePath),y.Instance.emit(f.ProjectileAttack,this.target.getComponent(v).id,this.attack)):(y.Instance.emit(f.ProjectileAttack,this.target.getComponent(v).id,this.attack),this.onDie())},e}(u)).prototype,"explodePath",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return d.TowerSound+"tower"+m.Explode}}),T=w))||T));a._RF.pop()}}}));

System.register("chunks:///_virtual/ProjecttileEmiter.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalDataMgr.ts","./Projectile.ts","./index2.ts","./GlobalEventMgr.ts","./Enum.ts","./LightningChain.ts"],(function(t){var e,i,o,n,r,l,c,a,s,p,h,u,j,g,f,P,d,m,y,v,R;return{setters:[function(t){e=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,n=t.assertThisInitialized},function(t){r=t.cclegacy,l=t._decorator,c=t.Prefab,a=t.Enum,s=t.Node,p=t.Pool,h=t.instantiate,u=t.UITransform,j=t.Component},function(t){g=t.default},function(t){f=t.Projecttile},function(t){P=t.createNode,d=t.getPos},function(t){m=t.default},function(t){y=t.MoveType,v=t.EventEnum},function(t){R=t.default}],execute:function(){var b,C,T,L,D,E,w,z,I,N,k;r._RF.push({},"5afa97LDAxHHpn3990lrpK5","ProjecttileEmiter",void 0);var x=l.ccclass,O=l.property;t("ProjecttileEmiter",(b=x("ProjecttileEmiter"),C=O(c),T=O({type:a(y),tooltip:"运动方式，Throw 抛掷、 Linear 线性、Lightning 闪电"}),L=O(s),D=O(s),b((z=e((w=function(t){function e(){for(var e,i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r))||this,o(e,"projectilePre",z,n(e)),e.projectilePool=null,o(e,"projectileType",I,n(e)),o(e,"emitPoint",N,n(e)),o(e,"projectileOnNode",k,n(e)),e.target=null,e.projectileRoot=null,e.grade=1,e.attack=0,e.lightningChain=null,e}i(e,t);var r=e.prototype;return r.start=function(){this.node.on("onProjectileLeave",this.onProjectileLeave,this),this.projectileRoot=g.Instance.stage.getChildByName("projectileRoot"),this.projectileRoot||(this.projectileRoot=P("projectileRoot"),g.Instance.stage.addChild(this.projectileRoot)),this.projectileRoot.getComponent(R)?this.lightningChain=this.projectileRoot.getComponent(R):this.lightningChain=this.projectileRoot.addComponent(R),this.loadResource(),this.initEvents()},r.initEvents=function(){m.Instance.on(v.ProjectileDie,this.onProjectileDie,this)},r.onDestroy=function(){m.Instance.off(v.ProjectileDie,this.onProjectileDie,this)},r.onProjectileDie=function(t,e){e===this.node.uuid&&this.projectilePool.free(t)},r.loadResource=function(){this.projectileType!==y.Lightning&&this.initProjectile()},r.initProjectile=function(){var t=this;this.projectilePool=new p((function(){var e=h(t.projectilePre);return e.active=!1,e.setParent(t.projectileRoot),e}),20,(function(t){t.removeFromParent(),t.destroy()}))},r.onProjectileLeave=function(t){if(!(t&&this.grade<t))if(this.projectileType!==y.Lightning){var e=this.projectilePool.alloc(),i=e.getComponent(f);if(i.moveType=this.projectileType,i.attack=this.attack,this.projectileType===y.Throw){var o=this.projectileOnNode.getComponent(u).contentSize;e.getComponent(u).setContentSize(o)}i.host=this.node,i.target=this.target;var n=d(this.emitPoint,this.projectileRoot);e.setPosition(n),e.active=!0}else this.playLightning()},r.playLightning=function(){var t=d(this.emitPoint,this.projectileRoot);this.lightningChain.play(t,this.target,this.projectilePre,this.attack)},r.pretendToAttack=function(){var t=d(this.node,g.Instance.stage);d(this.target,g.Instance.stage).x<t.x?this.projectileOnNode.setScale(-1,1):this.projectileOnNode.setScale(1,1)},e}(j)).prototype,"projectilePre",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I=e(w.prototype,"projectileType",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return y.Throw}}),N=e(w.prototype,"emitPoint",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=e(w.prototype,"projectileOnNode",[D],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=w))||E));r._RF.pop()}}}));

System.register("chunks:///_virtual/SampleAnimationByTween.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts"],(function(t){var n,i,e,o,r,a,u,s,p,l,c,y,h;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.inheritsLoose,e=t.initializerDefineProperty,o=t.assertThisInitialized},function(t){r=t.cclegacy,a=t._decorator,u=t.Enum,s=t.CCFloat,p=t.tween,l=t.v3,c=t.Sprite,y=t.Component},function(t){h=t.DirEnum}],execute:function(){var d,f,m,b,g,v,w,T,F,S,z;r._RF.push({},"9a5aacn7/ZMQ514JUy39Qp8","SampleAnimationByTween",void 0);var A=a.ccclass,B=a.property,C=function(t){return t.None="none",t.Angle="angle",t.Scale="scale",t.Position="position",t.Opacity="opacity",t}(C||{});t("SampleAnimationByTween",(d=A("SampleAnimationByTween"),f=B({type:u(C),tooltip:"选择动画类型"}),m=B({type:s,tooltip:"输入单次动画时长，单位s"}),b=B({type:s,tooltip:"输入运动幅度"}),g=B({type:u(h),tooltip:"输入运动方向"}),d((T=n((w=function(t){function n(){for(var n,i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return n=t.call.apply(t,[this].concat(r))||this,e(n,"tweenType",T,o(n)),e(n,"duration",F,o(n)),e(n,"num",S,o(n)),e(n,"dir",z,o(n)),n}i(n,t);var r=n.prototype;return r.start=function(){this.tweenType!==C.None&&this[this.tweenType]()},r.angle=function(){p(this.node).by(this.duration/2,{angle:this.num}).by(this.duration/2,{angle:-this.num}).union().repeatForever().start()},r.scale=function(){p(this.node).by(this.duration/2,{scale:function(){return l(.1,.1,1)}}).by(this.duration/2,{scale:function(){return l(-.1,-.1,1)}}).union().repeatForever().start()},r.position=function(){var t=this.dir===h.Left||this.dir===h.Right?this.num:0,n=this.dir===h.Top||this.dir===h.Bottom?this.num:0;p(this.node).by(this.duration/2,{position:l(t,n,0)}).by(this.duration/2,{position:l(-t,-n,0)}).by(this.duration/2,{position:l(-t,-n,0)}).by(this.duration/2,{position:l(t,n,0)}).union().repeatForever().start()},r.opacity=function(){var t=this.node.getComponent(c).color;p(t).to(this.duration/2,{a:255}).to(this.duration/2,{a:0}).union().repeatForever().start()},n}(y)).prototype,"tweenType",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C.None}}),F=n(w.prototype,"duration",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),S=n(w.prototype,"num",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),z=n(w.prototype,"dir",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h.Left}}),v=w))||v));r._RF.pop()}}}));

System.register("chunks:///_virtual/SecureStorag.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Singleton.ts","./index.ts"],(function(e){var t,n,r,o,c,a;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass},function(e){r=e.cclegacy,o=e.sys},function(e){c=e.default},function(e){a=e.C_UK}],execute:function(){r._RF.push({},"e966c8xCDFAYbgPC1Ub9xb6","SecureStorag",void 0);e("SecureStorage",function(e){function r(){var t;return(t=e.call(this)||this)._deviceKey=void 0,t._deviceKey=t.generateDeviceKey(),t}t(r,e);var c=r.prototype;return c.generateDeviceKey=function(){return o.platform+o.language+o.os},c.xorEncrypt=function(e,t){for(var n="",r=0;r<e.length;r++)n+=String.fromCharCode(e.charCodeAt(r)^t.charCodeAt(r%t.length));return n},c.getBase64=function(e){return btoa(unescape(encodeURIComponent(e)))},c.getDBase64=function(e){return decodeURIComponent(escape(atob(e)))},c.saveEncryptedData=function(e,t,n){e=this.getBase64(e);var r=this.xorEncrypt(t,n+this._deviceKey);o.localStorage.setItem(e,r)},c.loadEncryptedData=function(e,t){e=this.getBase64(e);var n=o.localStorage.getItem(e)||"";return this.xorEncrypt(n,t+this._deviceKey)},c.loadEncryptedFileData=function(e,t){var n=a.split("").reverse().join(""),r=this.getDBase64(e),o=this.xorEncrypt(r,n);try{return JSON.parse(o)}catch(e){return console.error(e),t}},n(r,null,[{key:"Instance",get:function(){return e.GetInstance.call(this)}}]),r}(c));r._RF.pop()}}}));

System.register("chunks:///_virtual/Singleton.ts",["cc"],(function(n){var t;return{setters:[function(n){t=n.cclegacy}],execute:function(){t._RF.push({},"dd017FE1klFJ6vvngivbrFF","Singleton",void 0),n("default",function(){function n(){}return n.GetInstance=function(){return this._instance||(this._instance=new this)},n}())._instance=null,t._RF.pop()}}}));

System.register("chunks:///_virtual/SubFSM.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var e,n;return{setters:[function(t){e=t.createClass},function(t){n=t.cclegacy}],execute:function(){n._RF.push({},"81574ORX+xGUJe/j/CM/pTl","SubFSM",void 0);t("default",function(){function t(t){this.stateMachine=new Map,this._currentState=void 0,this.fsm=t}return e(t,[{key:"currentState",get:function(){return this._currentState},set:function(t){t&&(this._currentState=t,this._currentState.stateChange())}}]),t}());n._RF.pop()}}}));

System.register("chunks:///_virtual/TopTool.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIMgr.ts","./GlobalDataMgr.ts","./AudioMgr.ts"],(function(n){var t,i,e,u,s,o,c,r,a,l,d,f;return{setters:[function(n){t=n.applyDecoratedDescriptor,i=n.inheritsLoose,e=n.initializerDefineProperty,u=n.assertThisInitialized},function(n){s=n.cclegacy,o=n._decorator,c=n.Node,r=n.Component},function(n){a=n.default,l=n.UIPanelName},function(n){d=n.default},function(n){f=n.default}],execute:function(){var p,M,h,v,g,B,m;s._RF.push({},"3f4detRz9JNfYHTWb1TORnN","TopTool",void 0);var I=o.ccclass,T=o.property;n("TopTool",(p=I("TopTool"),M=T(c),h=T(c),p((B=t((g=function(n){function t(){for(var t,i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return t=n.call.apply(n,[this].concat(s))||this,e(t,"musicBtn",B,u(t)),e(t,"soundBtn",m,u(t)),t}i(t,n);var s=t.prototype;return s.start=function(){var n=d.Instance.userConfig;this.musicBtn.children[0].active=!n.isMusicMuted,this.musicBtn.children[1].active=n.isMusicMuted,this.soundBtn.children[0].active=!n.isSoundMuted,this.soundBtn.children[1].active=n.isSoundMuted},s.onMusicClick=function(){var n=d.Instance.userConfig;n.isMusicMuted=!n.isMusicMuted,this.musicBtn.children[0].active=!n.isMusicMuted,this.musicBtn.children[1].active=n.isMusicMuted,n.isMusicMuted?f.Instance.pause():f.Instance.resume(),d.Instance.userConfig=n},s.onSoundClick=function(){var n=d.Instance.userConfig;n.isSoundMuted=!n.isSoundMuted,this.soundBtn.children[0].active=!n.isSoundMuted,this.soundBtn.children[1].active=n.isSoundMuted,d.Instance.userConfig=n},s.onSettingsClick=function(){a.Instance.openPanel(l.SettingsPanel)},t}(r)).prototype,"musicBtn",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m=t(g.prototype,"soundBtn",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=g))||v));s._RF.pop()}}}));

System.register("chunks:///_virtual/TowerAnimationState.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts","./EntityAnimationState.ts"],(function(t){var n,e,i,o;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy},function(t){i=t.ParamsNameEnum},function(t){o=t.EntityAnimationState}],execute:function(){e._RF.push({},"d985d2mpKJNP7mRq+hkMzd7","TowerAnimationState",void 0);t("TowerAnimationState",function(t){function e(){for(var n,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return(n=t.call.apply(t,[this].concat(o))||this).needLoadSource=!1,n.states=[i.Build1,i.Idle,i.Build2,i.Build3,i.Attack,i.Die],n}return n(e,t),e}(o));e._RF.pop()}}}));

System.register("chunks:///_virtual/TowerMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalDataMgr.ts","./Enum.ts","./EntityMgr.ts","./TowerAnimationState.ts","./ProjecttileEmiter.ts","./GlobalEventMgr.ts","./AudioMgr.ts","./index.ts","./index2.ts"],(function(t){var e,n,i,o,r,a,s,c,u,l,d,h,p,m,f,g,E,y,v,T;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,i=t._decorator,o=t.Animation},function(t){r=t.default},function(t){a=t.ParamsNameEnum,s=t.ResPathEnum,c=t.TowerAudioClipEnum,u=t.EventEnum,l=t.ActionTypeEnum,d=t.MoveType,h=t.EntityTypeEnum},function(t){p=t.default},function(t){m=t.TowerAnimationState},function(t){f=t.ProjecttileEmiter},function(t){g=t.default},function(t){E=t.default},function(t){y=t.C_TowerReward,v=t.C_TileSize},function(t){T=t.getUid}],execute:function(){var w;n._RF.push({},"86857ZK+ZdCXoRX4xZ8Kxz8","TowerMgr",void 0);var A=i.ccclass;i.property,t("TowerMgr",A("TowerMgr")(w=function(t){function n(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i))||this).type=h.Tower1,e.enemies=[],e.projecttileEmiter=null,e.data=null,e}e(n,t);var i=n.prototype;return i.start=function(){this.loadResource(),this.init()},i.init=function(){this.id=T(),this.fsm=this.node.addComponent(m),this.fsm.init(this.type),this.initEvents(),this.state=a["Build"+(this.data.grade||1)],this.projecttileEmiter.grade=this.data.grade,this.projecttileEmiter.attack=this.data.attack,E.Instance.playOneShot(s.TowerSound+"tower"+c.Build)},i.initEvents=function(){var t=this;this.node.getComponent(o).on(o.EventType.FINISHED,(function(){if(t.state===a.Die){var e=t.node.parent;return t.node.removeFromParent(),g.Instance.emit(u.EntityDie,e,t.type,t.data.cost*y,e.getPosition()),g.Instance.emit(u.ActionCardUse,l.Dismantle),void t.node.destroy()}t.state!==a.Idle&&(t.state=a.Idle)}))},i.loadResource=function(){this.enemies=r.Instance.stage.getChildByName("enemyRoot").children,this.projecttileEmiter=this.node.getComponent(f)},i.update=function(){this.state===a.Idle&&this.checkTowerCanAttack()},i.checkTowerCanAttack=function(){for(var t=this.data.range*v*r.Instance.mapsScale,e=0;e<this.enemies.length;e++){var n=this.enemies[e];if(n.active&&n.getComponent(p).state!==a.Die)if(this.node.parent.position.clone().subtract(n.position).length()<t)return this.state=a.Attack,this.projecttileEmiter.projectileType===d.Throw&&E.Instance.playOneShot(s.TowerSound+"tower"+c.Attack),this.projecttileEmiter.target=n,void this.projecttileEmiter.pretendToAttack()}},n}(p))||w);n._RF.pop()}}}));

System.register("chunks:///_virtual/TowersMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts","./index2.ts","./GlobalEventMgr.ts","./data.ts","./GlobalDataMgr.ts","./TowerMgr.ts","./AudioMgr.ts","./index.ts","./SecureStorag.ts"],(function(t){var e,n,o,r,a,i,s,c,u,h,l,f,d,w,g,C,T,v,m,p,y,P,E,I,D,b,k;return{setters:[function(t){e=t.inheritsLoose},function(t){n=t.cclegacy,o=t._decorator,r=t.instantiate,a=t.Input,i=t.Component},function(t){s=t.EventEnum,c=t.PrefabPathEnum,u=t.ResPathEnum,h=t.ActionTypeEnum,l=t.ParamsNameEnum,f=t.TowerAudioClipEnum},function(t){d=t.allSettled,w=t.loadPrefabs,g=t.loadPrefab},function(t){C=t.default},function(t){T=t.default},function(t){v=t.default},function(t){m=t.TowerMgr},function(t){p=t.default},function(t){y=t.C_TowerUP2Cost,P=t.C_TowerL2Attack,E=t.C_TowerL2Range,I=t.C_TowerUP3Cost,D=t.C_TowerL3Attack,b=t.C_TowerL3Range},function(t){k=t.SecureStorage}],execute:function(){var M;n._RF.push({},"6dc37jVwC1FTqoSxBIKZ1NA","TowersMgr",void 0);var B=o.ccclass,N=(o.property,k.Instance.loadEncryptedFileData(T,{}));t("TowersMgr",B("TowersMgr")(M=function(t){function n(){for(var e,n=arguments.length,o=new Array(n),r=0;r<n;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))||this).waitList=[],e.towerPrefabs=[],e.towerBuildBtnPrefab=null,e.towerDismantlePrefab=null,e.currentTower=null,e.towersNode=[],e}e(n,t);var o=n.prototype;return o.init=function(){var t=this,e=v.Instance.stage.getChildByName("towerRoots"),n=v.Instance.stage.getChildByName("towerRoots2");this.towersNode=[].concat(e.children,n.children),this.loadResource(),this.initEvents(),d(this.waitList).then((function(){console.log("加载防御塔相关资源完成"),t.initTowers()}))},o.initEvents=function(){C.Instance.on(s.MoneyChange,this.onMoneyChange,this),C.Instance.on(s.CurrentTowerCardChange,this.onMoneyChange,this),C.Instance.on(s.CardFirstClick,this.checkCardCost,this),C.Instance.on(s.ActionCardClick,this.toggleShowTowerDismantle,this)},o.offEvents=function(){C.Instance.off(s.MoneyChange,this.onMoneyChange,this),C.Instance.off(s.CurrentTowerCardChange,this.onMoneyChange,this),C.Instance.off(s.CardFirstClick,this.checkCardCost,this),C.Instance.off(s.ActionCardClick,this.toggleShowTowerDismantle,this)},o.onDestroy=function(){this.offEvents()},o.initTowers=function(){var t=this;this.towersNode.forEach((function(e){var n=r(t.towerBuildBtnPrefab);n.active=!1,n.setParent(e),n.on(a.EventType.TOUCH_END,t.towersNodeTouch,t)}))},o.loadResource=function(){var t=this,e=w(c.Tower).then((function(e){console.log("加载防御塔预制体成功"),t.towerPrefabs=e})).catch((function(t){console.error("加载防御塔预制体失败",t)})),n=g(c.TowerBuildBtn).then((function(e){console.log("加载防御塔建造预制体成功"),t.towerBuildBtnPrefab=e}));g(c.TowerDismantleBtn).then((function(e){console.log("加载防御塔拆除按钮预制体成功"),t.towerDismantlePrefab=e})),p.Instance.preLoad(u.TowerSound),this.waitList.push(e,n)},o.towersNodeTouch=function(t){var e=v.Instance,n=e.money,o=e.currentTowerCard,r=e.userData;if(o){var a=t.target.getParent();this.currentTower=a;var i=r.tower||{1:1},s=o.replace("tower",""),c=N[s];c.grade=i[s]||1,2===c.grade?(c.cost=c.cost*y,c.attack=c.attack*P,c.range=c.range*E):3===c.grade&&(c.cost=c.cost*I,c.attack=c.attack*D,c.range=c.range*b),n>=c.cost&&(a.children[0].active=!1,this.buildTower(c))}},o.onMoneyChange=function(){this.checkCardCost()},o.checkCardCost=function(){var t=v.Instance,e=t.money,n=t.currentTowerCard,o=!1;if(n&&e>0){var r=n.replace("tower","");e>=N[r].cost&&(o=!0)}this.towersNode.forEach((function(t){t.children.find((function(t){return t.name.startsWith("tower")}))||(t.children[0].active=o)}))},o.toggleShowTowerDismantle=function(t){var e=t===h.Dismantle;this.towersNode.forEach((function(t){var n=t.children.find((function(t){return t.name.startsWith("tower")}));if(n){var o=n.children.find((function(t){return"dismantleBtn"===t.name}));o&&(o.active=e)}}))},o.buildTower=function(t){var e=this;this.currentTower.children[0].active=!1;var n=this.towerPrefabs.find((function(e){return e.name==="tower"+t.type})),o=r(n);o.getComponent(m).data=t,o.setPosition(0,t.offset),o.setParent(this.currentTower),v.Instance.money-=t.cost,C.Instance.emit(s.CardUse,h.Build,"tower"+t.type);var i=r(this.towerDismantlePrefab);i.active=!1,i.setParent(o),i.on(a.EventType.TOUCH_END,(function(){i.destroy(),e.onDismantleClick(o)}),this)},o.onDismantleClick=function(t){t.getComponent(m).state=l.Die,p.Instance.playOneShot(u.TowerSound+"tower"+f.Die)},n}(i))||M);n._RF.pop()}}}));

System.register("chunks:///_virtual/Type.ts",["cc"],(function(){var e;return{setters:[function(c){e=c.cclegacy}],execute:function(){e._RF.push({},"5ac459NXe5DlY8DwCdbSgAO","Type",void 0),e._RF.pop()}}}));

System.register("chunks:///_virtual/UIBase.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,o,n,i,s,c,r;return{setters:[function(e){t=e.inheritsLoose},function(e){o=e.cclegacy,n=e._decorator,i=e.UITransform,s=e.view,c=e.director,r=e.Component}],execute:function(){var a;o._RF.push({},"d383cZ4EaRBKIPFzx92goT7","UIBase",void 0);var u=n.ccclass;n.property,e("UIBase",u("UIBase")(a=function(e){function o(){return e.apply(this,arguments)||this}t(o,e);var n=o.prototype;return n.onLoad=function(){var e=this.node.getChildByName("mask");e&&e.getComponent(i).setContentSize(s.getVisibleSize())},n.show=function(){this.node.active=!0},n.hide=function(e){void 0===e&&(e=!1),this.node.active=!1,e&&this.close()},n.close=function(){this.node.destroy()},n.onCloseClick=function(){this.hide()},n.onDestroy=function(){c.isPaused()&&c.resume()},o}(r))||a);o._RF.pop()}}}));

System.register("chunks:///_virtual/UIDialog.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIBase.ts"],(function(n){var t,e,i,o,r,c,l,u,a;return{setters:[function(n){t=n.applyDecoratedDescriptor,e=n.inheritsLoose,i=n.initializerDefineProperty,o=n.assertThisInitialized},function(n){r=n.cclegacy,c=n._decorator,l=n.Label,u=n.Node},function(n){a=n.UIBase}],execute:function(){var s,f,h,p,F,y,v;r._RF.push({},"454cbFa9UlD/5obLnIK82rv","UIDialog",void 0);var m=c.ccclass,g=c.property,b=n("DialogType",function(n){return n.Confirm="confirm",n.Alert="alert",n}({}));n("UIDialog",(s=m("UIDialog"),f=g(l),h=g(u),s((y=t((F=function(n){function t(){for(var t,e=arguments.length,r=new Array(e),c=0;c<e;c++)r[c]=arguments[c];return t=n.call.apply(n,[this].concat(r))||this,i(t,"content",y,o(t)),i(t,"footer",v,o(t)),t.type=b.Alert,t.confirmFun=null,t.cancelFun=null,t.closeFun=null,t}e(t,n);var r=t.prototype;return r.init=function(n){var t=n.content,e=n.confirmFun,i=n.type,o=void 0===i?b.Alert:i,r=n.cancelFun,c=n.closeFun;this.type=o,o===b.Confirm?(this.confirmFun=e,this.footer.active=!0):o===b.Alert&&(this.footer.active=!1,this.confirmFun=null),this.cancelFun=r,this.closeFun=c,this.content.string=t,this.node.active=!0},r.onCloseClick=function(){this.closeFun&&this.closeFun(),n.prototype.onCloseClick.call(this)},r.onCancelClick=function(){this.cancelFun&&this.cancelFun(),this.node.active=!1},r.onConfirmClick=function(){this.type!==b.Alert&&this.confirmFun&&this.confirmFun(),this.node.active=!1},t}(a)).prototype,"content",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v=t(F.prototype,"footer",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p=F))||p));r._RF.pop()}}}));

System.register("chunks:///_virtual/UIFailPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Enum.ts","./GlobalEventMgr.ts","./UIBase.ts","./UIMgr.ts","./AudioMgr.ts"],(function(n){var t,e,o,a,c,i,u,s,l,r,f,p;return{setters:[function(n){t=n.inheritsLoose},function(n){e=n.cclegacy,o=n._decorator,a=n.Tween,c=n.director},function(n){i=n.ResPathEnum,u=n.EventEnum,s=n.ScenceEnum},function(n){l=n.default},function(n){r=n.UIBase},function(n){f=n.default},function(n){p=n.default}],execute:function(){var d;e._RF.push({},"b067aHUtq9OSIoyAoJGJ+vk","UIFailPanel",void 0);var h=o.ccclass;n("UIFailPanel",h("UIFailPanel")(d=function(n){function e(){return n.apply(this,arguments)||this}t(e,n);var o=e.prototype;return o.show=function(){p.Instance.audioSource.clip=null,p.Instance.playOneShot(i.FailSound),n.prototype.show.call(this),a.stopAll(),c.pause()},o.onRestartClick=function(){this.node.active=!1,l.Instance.emit(u.GameRestart)},o.onBackClick=function(){f.Instance.onSceneChanged(),c.loadScene(s.Home)},e}(r))||d);e._RF.pop()}}}));

System.register("chunks:///_virtual/UILevelsPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./index.ts","./GlobalDataMgr.ts","./Enum.ts","./UIBase.ts","./UIMgr.ts"],(function(e){var t,n,i,a,r,c,o,l,s,u,h,g,v,p,f,P,d,b;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.initializerDefineProperty,a=e.assertThisInitialized},function(e){r=e.cclegacy,c=e._decorator,o=e.PageView,l=e.Prefab,s=e.Node,u=e.instantiate,h=e.Layout,g=e.Label,v=e.director},function(e){p=e.C_LevelsCount},function(e){f=e.default},function(e){P=e.ScenceEnum},function(e){d=e.UIBase},function(e){b=e.default}],execute:function(){var B,y,m,w,I,k,L,V,C,x,D;r._RF.push({},"bf851KIEBxHmpyQb60yS6f2","UILevelsPanel",void 0);var U=c.ccclass,z=c.property;e("UILevels",(B=U("UILevels"),y=z(o),m=z(l),w=z(s),I=z(s),B((V=t((L=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),c=0;c<n;c++)r[c]=arguments[c];return t=e.call.apply(e,[this].concat(r))||this,i(t,"pageView",V,a(t)),t.levelsRoot=null,i(t,"levelItem",C,a(t)),i(t,"nextButton",x,a(t)),i(t,"backButton",D,a(t)),t.currentPage=0,t.totolPage=0,t}n(t,e);var r=t.prototype;return r.onLoad=function(){this.levelsRoot=this.pageView.content.children[0]},r.onEnable=function(){this.currentPage=0,this.pageView.removeAllPages(),this.totolPage=Math.ceil(p/8);var e=f.Instance.userData;e.levels=e.levels||[];for(var t=e.levels.length+1,n=1;n<=2;n++){var i=u(this.levelsRoot);i.active=1===n,this.pageView.addPage(i)}this.pageView.content.getComponent(h).updateLayout();for(var a=1;a<=p;a++){var r=0,c=t<a;c||(r=e.levels[a-1]||0),this.setLevelButton(a,r,c)}this.checkPageBtn()},r.getParentPage=function(e){var t=Math.ceil(e/8);return this.pageView.content.children[t-1]},r.setLevelButton=function(e,t,n){var i=this,a=u(this.levelItem);a.getChildByName("Label").getComponent(g).string=e.toString(),a.getChildByName("star").children[t].active=!0;var r=a.getChildByName("Mask");n||a.on(s.EventType.TOUCH_END,(function(){i.toGame(e)}),this),r.active=n,a.setParent(this.getParentPage(e))},r.onBackClick=function(){this.pageView.content.children[this.currentPage].active=!1,this.currentPage--,this.pageView.setCurrentPageIndex(this.currentPage),this.checkPageBtn(),this.pageView.content.children[this.currentPage].active=!0},r.onNextClick=function(){this.pageView.content.children[this.currentPage].active=!1,this.currentPage++,this.pageView.setCurrentPageIndex(this.currentPage),this.checkPageBtn(),this.pageView.content.children[this.currentPage].active=!0},r.checkPageBtn=function(){this.totolPage>1?(0===this.currentPage?this.backButton.active=!1:this.backButton.active=!0,this.currentPage<this.totolPage-1?this.nextButton.active=!0:this.nextButton.active=!1):(this.nextButton.active=!1,this.backButton.active=!1)},r.toGame=function(e){f.Instance.userData.level=e,f.Instance.userData=f.Instance.userData,b.Instance.onSceneChanged(),v.loadScene(P.Battle)},t}(d)).prototype,"pageView",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=t(L.prototype,"levelItem",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=t(L.prototype,"nextButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=t(L.prototype,"backButton",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=L))||k));r._RF.pop()}}}));

System.register("chunks:///_virtual/UIMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Singleton.ts","./index2.ts","./Enum.ts","./UIDialog.ts","./UIBase.ts"],(function(e){var t,n,i,a,o,l,s,r,u,c,h,g,p,P;return{setters:[function(e){t=e.inheritsLoose,n=e.createClass,i=e.asyncToGenerator,a=e.regeneratorRuntime},function(e){o=e.cclegacy,l=e.director,s=e.instantiate,r=e.view,u=e.UITransform},function(e){c=e.default},function(e){h=e.loadPrefab},function(e){g=e.PrefabPathEnum},function(e){p=e.UIDialog},function(e){P=e.UIBase}],execute:function(){o._RF.push({},"67c00Qq1FdPHb/pADllYzsN","UIMgr",void 0);var d=e("UIPanelName",function(e){return e.PausePanel="pausePanel",e.WinPanel="winPanel",e.FailPanel="failPanel",e.StartPanel="startPanel",e.LevelsPanel="levelsPanel",e.UpgradePanel="upgradePanel",e.Dialog="dialog",e.SettingsPanel="settingsPanel",e.GamePanel="gamePanel",e.GameHeader="gameHeader",e.BottomTool="bottomTool",e}({}));e("default",function(e){function o(){for(var t,n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=e.call.apply(e,[this].concat(i))||this)._uiPanelMap=new Map,t.dialog=null,t._uiRoot=null,t}t(o,e);var c=o.prototype;return c.openPanel=function(e,t){var n=this;void 0===t&&(t=!1),null==this._uiRoot&&(this._uiRoot=l.getScene().getChildByName("UIRoot"),this.resize()),t&&this.closeAll(),this._uiPanelMap.has(e)?this._uiPanelMap.get(e).getComponent(P).show():h(g.UIPanel+e).then((function(t){var i=s(t);n._uiRoot.addChild(i),n._uiPanelMap.set(e,i),i.getComponent(P).show()}))},c.closePanel=function(e,t){(void 0===t&&(t=!1),this._uiPanelMap.has(e))&&this._uiPanelMap.get(e).getComponent(P).hide(t)},c.closeAll=function(){for(var e in this._uiPanelMap){if(Object.prototype.hasOwnProperty.call(this._uiPanelMap,e))this._uiPanelMap[e].getComponent(P).hide()}},c.resize=function(){var e=r.getVisibleSize();this._uiRoot.getComponent(u).setContentSize(e.width,e.height)},c.openDilog=function(){var e=i(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this._uiRoot&&(this._uiRoot=l.getScene().getChildByName("UIRoot"),this.resize()),this.dialog){e.next=7;break}return e.next=4,h(g.UIPanel+d.Dialog);case 4:n=e.sent,this.dialog=s(n),this.dialog.setParent(this._uiRoot);case 7:this.dialog.setSiblingIndex(this._uiRoot.children.length),this.dialog.getComponent(p).init(t);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),c.closeDialog=function(){this.dialog.getComponent(P).hide()},c.onSceneChanged=function(){this._uiRoot=null,this.dialog=null,this._uiPanelMap.clear()},n(o,null,[{key:"Instance",get:function(){return e.GetInstance.call(this)}}]),o}(c));o._RF.pop()}}}));

System.register("chunks:///_virtual/UISettings.ts",["./rollupPluginModLoBabelHelpers.js","cc","./LanguageData.ts","./index.ts","./UIBase.ts","./GlobalDataMgr.ts","./AudioMgr.ts","./Enum.ts","./GlobalEventMgr.ts"],(function(e){var n,t,r,i,a,o,s,u,l,g,c,f,d,p,h,m,I,S,C,b,v,y,w;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,r=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){a=e.cclegacy,o=e._decorator,s=e.Label,u=e.Node,l=e.ToggleContainer,g=e.ProgressBar,c=e.Slider,f=e.instantiate,d=e.Toggle},function(e){p=e.init,h=e.updateSceneRenderers},function(e){m=e.C_LanguageList},function(e){I=e.UIBase},function(e){S=e.default},function(e){C=e.default},function(e){b=e.EventEnum,v=e.ResPathEnum,y=e.UITypeEnum},function(e){w=e.default}],execute:function(){var B,P,L,z,U,M,E,V,D,_,R,T,A,N,k,x,F;a._RF.push({},"3e43euIdp9K56uc6f9eeQuM","UISettings",void 0);var G=o.ccclass,O=o.property;e("UISettings",(B=G("UISettings"),P=O(s),L=O(u),z=O(l),U=O(g),M=O(c),E=O(g),V=O(c),B((R=n((_=function(e){function n(){for(var n,t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return n=e.call.apply(e,[this].concat(a))||this,r(n,"language",R,i(n)),r(n,"languageSelectorView",T,i(n)),r(n,"languageSelector",A,i(n)),n.langItem=null,r(n,"soundProgressBar",N,i(n)),r(n,"soundSlider",k,i(n)),r(n,"musicProgressBar",x,i(n)),r(n,"musicSlider",F,i(n)),n}t(n,e);var a=n.prototype;return a.show=function(){this.initVolume(),this.langItem=this.languageSelector.node.children[0],this.languageSelector.node.removeAllChildren();var n=m.find((function(e){return e.value==S.Instance.userConfig.language}));this.language.string=n?n.name:m[0].name,this.initLangSelector(),e.prototype.show.call(this)},a.initVolume=function(){this.soundProgressBar.progress=(S.Instance.userConfig.sound||50)/100,this.soundSlider.progress=(S.Instance.userConfig.sound||50)/100,this.musicProgressBar.progress=(S.Instance.userConfig.music||50)/100,this.musicSlider.progress=(S.Instance.userConfig.music||50)/100},a.initLangSelector=function(){var e=this;m.forEach((function(n){var t=f(e.langItem);t.getChildByName("label").getComponent(s).string=n.name,t.name=n.value,t.getComponent(d).isChecked=S.Instance.userConfig.language==n.value,e.languageSelector.node.addChild(t)}))},a.showLangSelector=function(){this.languageSelectorView.active=!0},a.changeLang=function(e){var n=e.node.name;this.languageSelectorView.active=!1,n!==S.Instance.userConfig.language&&(this.language.string=e.node.getChildByName("label").getComponent(s).string,p(n),h(),w.Instance.emit(b.ChangeLang),S.Instance.userConfig.language=n,S.Instance.userConfig=S.Instance.userConfig)},a.onSoundSliderChange=function(e){var n=Math.round(100*e.progress);e.progress=n/100,this.soundProgressBar.progress=e.progress,S.Instance.userConfig.sound=n,S.Instance.userConfig=S.Instance.userConfig,C.Instance.playOneShot(v.UISound+y.Button)},a.onMusicSliderChange=function(e){var n=Math.round(100*e.progress);e.progress=n/100,this.musicProgressBar.progress=e.progress,S.Instance.userConfig.music=n,S.Instance.userConfig=S.Instance.userConfig,C.Instance.changeVolume(n/100),C.Instance.playOneShot(v.UISound+y.Switch)},n}(I)).prototype,"language",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T=n(_.prototype,"languageSelectorView",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A=n(_.prototype,"languageSelector",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),N=n(_.prototype,"soundProgressBar",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),k=n(_.prototype,"soundSlider",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=n(_.prototype,"musicProgressBar",[E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=n(_.prototype,"musicSlider",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=_))||D));a._RF.pop()}}}));

System.register("chunks:///_virtual/UIUpgradePanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./UIMgr.ts","./GlobalDataMgr.ts","./index2.ts","./Enum.ts","./cardData.ts","./UIDialog.ts","./UIBase.ts","./SecureStorag.ts"],(function(t){var e,a,n,r,i,o,s,c,l,u,d,g,f,p,h,v,y,C,m,b,L,U,D;return{setters:[function(t){e=t.applyDecoratedDescriptor,a=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){i=t.cclegacy,o=t._decorator,s=t.Prefab,c=t.Label,l=t.Node,u=t.Layout,d=t.instantiate,g=t.Sprite,f=t.BlockInputEvents},function(t){p=t.default},function(t){h=t.default},function(t){v=t.loadAtlas,y=t.allSettled,C=t.$t},function(t){m=t.ResPathEnum},function(t){b=t.default},function(t){L=t.DialogType},function(t){U=t.UIBase},function(t){D=t.SecureStorage}],execute:function(){var I,k,w,S,B,P,N,R,E;i._RF.push({},"8946c3zfMNM4KSS15tAWc0L","UIUpgradePanel",void 0);var M=o.ccclass,z=o.property,F=D.Instance.loadEncryptedFileData(b,[]);t("UIUpgradePanel",(I=M("UIUpgradePanel"),k=z(s),w=z(c),S=z(l),I((N=e((P=function(t){function e(){for(var e,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,n(e,"cardPrefab",N,r(e)),n(e,"starsLabel",R,r(e)),n(e,"cardRoot",E,r(e)),e.cardSps=null,e.waitList=[],e}a(e,t);var i=e.prototype;return i.onEnable=function(){var t=h.Instance.userData;this.starsLabel.string=(t.stars||"0").toString(),this.cardSps?this.init():this.loadResource()},i.loadResource=function(){var t=this,e=v(m.UICard).then((function(e){t.cardSps=e}));this.waitList.push(e),y(this.waitList).then((function(){console.log("加载游戏卡片相关资源完成"),t.init()}))},i.init=function(){this.cardRoot.removeAllChildren(),this.initCards(),this.cardRoot.getComponent(u).updateLayout()},i.initCards=function(){var t=this,e=h.Instance.userData.tower||{1:1};F.forEach((function(a){a.isUnLock=!!e[a.type];var n=e[a.type]||1;a.grade=n,a.name="tower"+a.type,t.creatCard(a,"tower")}))},i.creatCard=function(t,e){var a=this,n=d(this.cardPrefab);n.getChildByName("icon").getComponent(g).spriteFrame=this.cardSps.getSpriteFrame(t.icon),n.on(l.EventType.TOUCH_END,(function(){a.onCardClick(n,t,e)}),this),this.setCardData(n,t,e),"tower"==e&&n.setParent(this.cardRoot)},i.setCardData=function(t,e,a){var n=t.getChildByName("star"),r=n.getChildByName("Label").getComponent(c),i=t.getChildByName("Mask"),o=t.getChildByName("grade").getComponent(c);if(e.isUnLock)if(t.getChildByName("lock").active=!1,n.active=!0,i.active=!1,"tower"===a){if(3===e.grade)n.active=!1,i.active=!0;else{var s=e.star[e.grade];r.string=s.toString()}o.string="L"+e.grade}else o.node.active=!1;else r.string=e.star[0]+"",this.setLock(!1,t)},i.onCardClick=function(t,e,a){var n=this,r=h.Instance.userData,i=e.star[0],o=C("tower"===a?"tower."+e.name:"buff."+e.name);if(e.isUnLock&&(i=e.star[e.grade]),r.stars>=i){var s=C(e.isUnLock?"dialog.upgradeText":"dialog.upgradeText2",[i+"",o]);p.Instance.openDilog({content:s,type:L.Confirm,confirmFun:function(){r.stars-=i,r.tower=r.tower||{1:1},e.isUnLock?(e.grade=e.grade+1,n.setCardData(t,e,a),n.starsLabel.string=r.stars+""):(e.grade=1,n.setLock(!0,t,(function(){e.isUnLock=!0,n.setCardData(t,e,a),n.starsLabel.string=r.stars+""}))),r.tower[e.type]=e.grade,h.Instance.userData=r}})}else p.Instance.openDilog({content:C("dialog.upgradeError")})},i.setLock=function(t,e,a){var n=e.getChildByName("Mask"),r=e.getChildByName("lock"),i=n.getComponent(f);n.active=!0,r.active=!0,t?(this.scheduleOnce((function(){r.children[0].active=!1,r.children[1].active=!0}),.5),this.scheduleOnce((function(){r.active=!1,n.active=!1,i.enabled=!0,a&&a()}),1)):(i.enabled=!1,n.active=!0,r.children[0].active=!0,r.children[1].active=!1)},e}(U)).prototype,"cardPrefab",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),R=e(P.prototype,"starsLabel",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(P.prototype,"cardRoot",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=P))||B));i._RF.pop()}}}));

System.register("chunks:///_virtual/UIWinPanel.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalDataMgr.ts","./Enum.ts","./GlobalEventMgr.ts","./UIBase.ts","./UIMgr.ts","./AudioMgr.ts","./index.ts"],(function(t){var e,n,a,r,i,o,l,s,u,c,f,v,p,h,d,b,g,I,m;return{setters:[function(t){e=t.applyDecoratedDescriptor,n=t.inheritsLoose,a=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){i=t.cclegacy,o=t._decorator,l=t.Node,s=t.Label,u=t.Tween,c=t.director},function(t){f=t.default},function(t){v=t.ResPathEnum,p=t.ScenceEnum,h=t.EventEnum},function(t){d=t.default},function(t){b=t.UIBase},function(t){g=t.default},function(t){I=t.default},function(t){m=t.C_LevelsCount}],execute:function(){var y,B,w,S,L,x,R,D,E,M,P;i._RF.push({},"b8346aq43dH4rL+I+THtcNY","UIWinPanel",void 0);var U=o.ccclass,z=o.property;t("UIWinPanel",(y=U("UIWinPanel"),B=z(l),w=z(l),S=z(l),L=z(s),y((D=e((R=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i))||this,a(e,"starRoot",D,r(e)),a(e,"nextButton",E,r(e)),a(e,"restartButton",M,r(e)),a(e,"rewardLabel",P,r(e)),e}n(e,t);var i=e.prototype;return i.show=function(){I.Instance.audioSource.clip=null,I.Instance.playOneShot(v.WinSound),t.prototype.show.call(this),this.setStar(),u.stopAll(),c.pause()},i.getStart=function(){var t=f.Instance,e=t.life,n=t.levelData,a=t.userData,r=a.level||1;a.levels=a.levels||[];var i=a.levels[r-1]||0,o=Math.ceil(e/n.life*3);a.levels[r-1]=Math.max(o,i),r<m?(a.level=r+1,this.nextButton.active=!0,this.restartButton.active=!1):(this.nextButton.active=!1,this.restartButton.active=!0),a.stars=a.stars||0;var l=o-i>0?o-i:0;return a.stars+=l,f.Instance.userData=a,this.rewardLabel.string="+"+l,o},i.setStar=function(){var t=this.getStart();this.starRoot.children.forEach((function(e,n){e.active=n===t}))},i.onBackClick=function(){g.Instance.onSceneChanged(),c.loadScene(p.Home)},i.onNextLevelClick=function(){this.node.active=!1,d.Instance.emit(h.GameNextLevel)},i.onRestartClick=function(){this.node.active=!1,d.Instance.emit(h.GameRestart)},e}(b)).prototype,"starRoot",[B],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E=e(R.prototype,"nextButton",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=e(R.prototype,"restartButton",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=e(R.prototype,"rewardLabel",[L],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=R))||x));i._RF.pop()}}}));

System.register("chunks:///_virtual/WaveMgr.ts",["./rollupPluginModLoBabelHelpers.js","cc","./GlobalDataMgr.ts","./index2.ts","./EnemyMgr.ts","./Enum.ts","./index.ts","./GlobalEventMgr.ts","./AudioMgr.ts"],(function(e){var t,a,n,i,r,s,m,o,c,v,h,u,l,y,T,w,f,d,W,p,g,I,C,D;return{setters:[function(e){t=e.applyDecoratedDescriptor,a=e.inheritsLoose,n=e.initializerDefineProperty,i=e.assertThisInitialized},function(e){r=e.cclegacy,s=e._decorator,m=e.Prefab,o=e.math,c=e.view,v=e.Pool,h=e.instantiate,u=e.ProgressBar,l=e.tween,y=e.Component},function(e){T=e.default},function(e){w=e.loadPrefab},function(e){f=e.EnemyMgr},function(e){d=e.ResPathEnum,W=e.EventEnum,p=e.PrefabPathEnum,g=e.GameStateEnum},function(e){I=e.C_WaveTimer},function(e){C=e.default},function(e){D=e.default}],execute:function(){var E,S,P,x,b;r._RF.push({},"4f5b6l1/whCf6dA7uwhq6fi","WaveMgr",void 0);var _=s.ccclass,M=s.property;e("default",(E=_("WaveMgr"),S=M(m),E((b=t((x=function(e){function t(){for(var t,a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return t=e.call.apply(e,[this].concat(r))||this,n(t,"enemyPrefab",b,i(t)),t.wavesTimer=null,t.size=new o.Size,t.waveIndex=0,t.enemyIndex=0,t._enemyPools=new Map,t.canCheckGameWin=!1,t.waveWaitTimer=0,t.enemyCreateTimer=0,t.currentWaveTimerData={waveWaitTimer:0,waveWaitTimerStart:!1,enemyCreateTimer:0,enemyCreateTimerStart:!1,enemyCount:0},t}a(t,e);var r=t.prototype;return r.start=function(){this.size=c.getViewportRect().size,D.Instance.preLoad(d.EnemySound)},r.initPool=function(){var e=this;return new v((function(){var t=h(e.enemyPrefab);return t.active=!1,t}),8,(function(e){e.removeFromParent()}))},r.init=function(){this.canCheckGameWin=!1,this.waveIndex=0,this.enemyIndex=0,this.createWave()},r.resetCurrentWaveTimerData=function(){this.currentWaveTimerData={waveWaitTimer:0,waveWaitTimerStart:!1,enemyCreateTimer:0,enemyCreateTimerStart:!1,enemyCount:0}},r.createWave=function(){if(T.Instance.levelData)if(this.resetCurrentWaveTimerData(),0===this.waveIndex)this.initWaveTips(),C.Instance.emit(W.EnemySpawn,I,0);else{var e=T.Instance.levelData.waves[this.waveIndex];this.currentWaveTimerData.waveWaitTimer=e.interval,this.currentWaveTimerData.waveWaitTimerStart=!0,C.Instance.emit(W.EnemySpawn,this.currentWaveTimerData.waveWaitTimer+I,this.waveIndex)}},r.createEnemies=function(){var e=T.Instance.levelData.waves[this.waveIndex].enemies[this.enemyIndex];this.currentWaveTimerData.enemyCount=0,0===this.enemyIndex&&this.spawnEnemy(),this.currentWaveTimerData.enemyCreateTimer=e.spawnInterval,this.currentWaveTimerData.enemyCreateTimerStart=!0},r.spawnEnemy=function(){var e=T.Instance,t=e.stage,a=e.levelData.waves,n=t.getChildByName("enemyRoot"),i=a[this.waveIndex].enemies,r=i[this.enemyIndex];if(this.currentWaveTimerData.enemyCount>=r.count)if(this.enemyIndex===i.length-1){if(this.waveIndex===a.length-1)return this.currentWaveTimerData.enemyCreateTimerStart=!1,void(this.canCheckGameWin=!0);this.waveIndex++,this.enemyIndex=0,this.createWave()}else this.enemyIndex++,this.createEnemies();else{var s=this.getNode(r.type);s.getComponent(f).init(r),s.setParent(n),this.currentWaveTimerData.enemyCount++,C.Instance.emit(W.EnemySpawn,r.spawnInterval),this.currentWaveTimerData.enemyCount===r.count&&this.spawnEnemy()}},r.getNode=function(e){var t="enemy"+e,a=this._enemyPools.get(t);a||(this._enemyPools.set(t,this.initPool()),a=this._enemyPools.get(t));var n=a.alloc();return n.active?this.getNode(e):n},r.initWaveTips=function(){var e=this,t=T.Instance.stage;this.wavesTimer?this.setintervalWave():w(p.WavesTimer).then((function(a){e.wavesTimer=h(a);var n=t.getChildByName("decor2Roots"),i=T.Instance.startPoint,r=i.x,s=i.y,m=i.dir;e.wavesTimer.setPosition(r,s),e.wavesTimer.angle=90*-m,e.wavesTimer.getChildByName("bg").angle=90*m,n.addChild(e.wavesTimer),e.setintervalWave()}))},r.setintervalWave=function(){var e=this,t=this.wavesTimer.getComponent(u);t.progress=1,this.wavesTimer.active=!0,D.Instance.play(d.EnemySound+"wave"),l(t).to(I,{progress:0}).call((function(){e.wavesTimer.active=!1,e.createEnemies()})).start()},r.freeEnemy=function(e,t){e.removeFromParent(),e.active=!1,this._enemyPools.get(t).free(e)},r.onDestroy=function(){C.Instance.off(W.EnemySpawn,this.spawnEnemy,this),this._enemyPools.clear()},r.update=function(e){T.Instance.gameState===g.Start&&(this.currentWaveTimerData.waveWaitTimerStart&&(this.waveWaitTimer+=e*T.Instance.gameSpeedScale,(this.waveWaitTimer>=this.currentWaveTimerData.waveWaitTimer||this.checkLastEnemyDead())&&(this.waveWaitTimer=0,this.currentWaveTimerData.waveWaitTimerStart=!1,this.initWaveTips())),this.currentWaveTimerData.enemyCreateTimerStart&&(this.enemyCreateTimer+=e*T.Instance.gameSpeedScale,this.enemyCreateTimer>=this.currentWaveTimerData.enemyCreateTimer&&(this.enemyCreateTimer=0,this.spawnEnemy())))},r.checkLastEnemyDead=function(){return 0===T.Instance.stage.getChildByName("enemyRoot").children.length&&(C.Instance.emit(W.EnemySpawn,I,this.waveIndex),!0)},t}(y)).prototype,"enemyPrefab",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=x))||P));r._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});